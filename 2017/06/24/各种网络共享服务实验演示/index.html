<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>各种网络共享服务实验演示 | 李登峰博客</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">各种网络共享服务实验演示</h1><a id="logo" href="/.">李登峰博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">各种网络共享服务实验演示</h1><div class="post-meta"><a href="/2017/06/24/各种网络共享服务实验演示/#comments" class="comment-count"></a><p><span class="date">Jun 24, 2017</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Schlägt</i></i></span></p></div><div class="post-content"><h2 id="实验：-实现基于文件验证的-vsftpd-虚拟用户"><a href="#实验：-实现基于文件验证的-vsftpd-虚拟用户" class="headerlink" title="实验： 实现基于文件验证的 vsftpd 虚拟用户"></a>实验： 实现基于文件验证的 vsftpd 虚拟用户</h2><h5 id="先创建一个存放虚拟用户的账号密码的文件-vim-etc-vsftpd-vsftpusers"><a href="#先创建一个存放虚拟用户的账号密码的文件-vim-etc-vsftpd-vsftpusers" class="headerlink" title="先创建一个存放虚拟用户的账号密码的文件      vim /etc/vsftpd/vsftpusers"></a>先创建一个存放虚拟用户的账号密码的文件      vim /etc/vsftpd/vsftpusers</h5><p> 在里面添加               ftpuser1<br>                                  centos<br>                                  ftpuser2<br>                                  magedu<br>                                   ftpuser3<br>                                   rhel  </p>
<h5 id="这个文件中奇数行是虚拟账户，偶数行是密码。"><a href="#这个文件中奇数行是虚拟账户，偶数行是密码。" class="headerlink" title="这个文件中奇数行是虚拟账户，偶数行是密码。"></a>这个文件中奇数行是虚拟账户，偶数行是密码。</h5><a id="more"></a>
<h5 id="创建完后这个文件还不能直接使用，还要把它转化成-Berkeley-db-数据库格式的文件。"><a href="#创建完后这个文件还不能直接使用，还要把它转化成-Berkeley-db-数据库格式的文件。" class="headerlink" title="创建完后这个文件还不能直接使用，还要把它转化成 Berkeley db 数据库格式的文件。"></a>创建完后这个文件还不能直接使用，还要把它转化成 Berkeley db 数据库格式的文件。</h5><p>  cd  /tec/vsftpd<br> db_load -T -t hash -f vsftpusers vsftpusers.db  </p>
<h5 id="创建完后会生成一个-vsftpusers-db-文件，这个文件是二进制格式的。"><a href="#创建完后会生成一个-vsftpusers-db-文件，这个文件是二进制格式的。" class="headerlink" title="创建完后会生成一个 vsftpusers.db 文件，这个文件是二进制格式的。"></a>创建完后会生成一个 vsftpusers.db 文件，这个文件是二进制格式的。</h5><h5 id="然后对这个文件修改权限"><a href="#然后对这个文件修改权限" class="headerlink" title="然后对这个文件修改权限"></a>然后对这个文件修改权限</h5><p> chmod 600 vsftpusers.db  </p>
<h5 id="这样以前那个文件就没用了，可以把删除掉，避免数据流出。"><a href="#这样以前那个文件就没用了，可以把删除掉，避免数据流出。" class="headerlink" title="这样以前那个文件就没用了，可以把删除掉，避免数据流出。"></a>这样以前那个文件就没用了，可以把删除掉，避免数据流出。</h5><p>rm vsftpusers  </p>
<h5 id="现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。"><a href="#现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。" class="headerlink" title="现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。"></a>现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。</h5><p> useradd -r -d /data/ftp -s /sbin/nologin vuser  </p>
<h5 id="然后把家目录创建出来，并修改权限-因为ftp-家目录系统是不支持有写权限的。"><a href="#然后把家目录创建出来，并修改权限-因为ftp-家目录系统是不支持有写权限的。" class="headerlink" title="然后把家目录创建出来，并修改权限,因为ftp 家目录系统是不支持有写权限的。"></a>然后把家目录创建出来，并修改权限,因为ftp 家目录系统是不支持有写权限的。</h5><p>  mkdir /data/ftp<br>  chown vuser.vuser /data/ftp<br>  chmod -w /data/ftp  </p>
<h5 id="接下来要调用-vsftpuser-db-这个数据库时还要在-pam-模块配置文件中创建一个文件"><a href="#接下来要调用-vsftpuser-db-这个数据库时还要在-pam-模块配置文件中创建一个文件" class="headerlink" title="接下来要调用 vsftpuser.db  这个数据库时还要在 pam 模块配置文件中创建一个文件"></a>接下来要调用 vsftpuser.db  这个数据库时还要在 pam 模块配置文件中创建一个文件</h5><pre><code>cd /etc/pam.d/  
</code></pre><p>   vim vsftpd.db  </p>
<p>在里面添加<br>  auth required pam_userdb.so db=/etc/vsftpd/vsftpusers<br> account required pam_userdb.so db=/etc/vsftpd/vsftpusers  </p>
<h5 id="pam-模块配置文件创建好了但是-系统并不知道有这个文件，所以还要在-ftp-服务的主配置文件中添加相应内容。"><a href="#pam-模块配置文件创建好了但是-系统并不知道有这个文件，所以还要在-ftp-服务的主配置文件中添加相应内容。" class="headerlink" title="pam 模块配置文件创建好了但是 系统并不知道有这个文件，所以还要在 ftp 服务的主配置文件中添加相应内容。"></a>pam 模块配置文件创建好了但是 系统并不知道有这个文件，所以还要在 ftp 服务的主配置文件中添加相应内容。</h5><pre><code>vim /etc/vsftpd/vsftpd.conf  
</code></pre><p>在里面修改添加<br>       pam_service_name=vsftpd.db<br>       guest_enable=YES<br>       guest_username=vuser  </p>
<h5 id="接下来还要给虚拟账号创建各自的独立的配置文件"><a href="#接下来还要给虚拟账号创建各自的独立的配置文件" class="headerlink" title="接下来还要给虚拟账号创建各自的独立的配置文件"></a>接下来还要给虚拟账号创建各自的独立的配置文件</h5><p> 先创建一个文件夹<br> mkdir /etc/vsftpd/vusers.d/  </p>
<p>光创建这个文件夹还不行，系统不知道把虚拟用户的配置文件放在这里，所以还要在主配置文件中添加信息  </p>
<p> vim /etc/vsftpd/vsftpd.conf<br>user_config_dir=/etc/vsftpd/vusers.d/   </p>
<h5 id="接下来创建虚拟用户各自的配置文件-在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。"><a href="#接下来创建虚拟用户各自的配置文件-在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。" class="headerlink" title="接下来创建虚拟用户各自的配置文件 ,在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。"></a>接下来创建虚拟用户各自的配置文件 ,在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。</h5><p> cd /etc/vsftpd/vusers.d/<br>   vim ftpuser1<br>在里面添加<br>anon_upload_enable=YES<br>anon_mkdir_write_enable=YES<br> anon_other_write_enable=YES   </p>
<h5 id="加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。"><a href="#加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。" class="headerlink" title="加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。"></a>加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。</h5><p> mkdir /data/ftp/upload<br>setfacl -m u:vuser:rwx /data/ftp/upload  </p>
<h5 id="这样虚拟账号-ftpuser1-对这个文件夹就有写权限了-。"><a href="#这样虚拟账号-ftpuser1-对这个文件夹就有写权限了-。" class="headerlink" title="这样虚拟账号 ftpuser1 对这个文件夹就有写权限了 。"></a>这样虚拟账号 ftpuser1 对这个文件夹就有写权限了 。</h5><h5 id="但是-ftpuser1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftpuser2-虚拟账户连接-ftp-后家目录不是刚才-ftpuser1-的那个根目录，而是一个独立的根目录。"><a href="#但是-ftpuser1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftpuser2-虚拟账户连接-ftp-后家目录不是刚才-ftpuser1-的那个根目录，而是一个独立的根目录。" class="headerlink" title="但是 ftpuser1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftpuser2 虚拟账户连接 ftp 后家目录不是刚才 ftpuser1  的那个根目录，而是一个独立的根目录。"></a>但是 ftpuser1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftpuser2 虚拟账户连接 ftp 后家目录不是刚才 ftpuser1  的那个根目录，而是一个独立的根目录。</h5><pre><code>先创建一个文件夹  
</code></pre><p> mkdir /data2/ftp<br> cd /etc/vsftpd/vusers.d/<br>     vim ftpuser2<br> 在里面添加<br>     local_root=/ftproot<br>重启服务<br>systemctl restart vsftpd<br>这样 虚拟用户 ftpuser2 连接后根目录就是 /data2/ftp  这个目录了。  </p>
<h5 id="当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。"><a href="#当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。" class="headerlink" title="当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。"></a>当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。</h5><h5 id="先创建一个文件夹-然后给上权限-注意这儿给权限的用户是映射的那个系统账号哦"><a href="#先创建一个文件夹-然后给上权限-注意这儿给权限的用户是映射的那个系统账号哦" class="headerlink" title="先创建一个文件夹,然后给上权限,注意这儿给权限的用户是映射的那个系统账号哦"></a>先创建一个文件夹,然后给上权限,注意这儿给权限的用户是映射的那个系统账号哦</h5><p>mkdir /data2/ftp/upload<br>setfacl -m u:vuser:rwx upload<br>然后在虚拟账号的配置文件中添加内容<br>vim ftpuser2<br>anon_upload_enable=YES<br>anon_mkdir_write_enable=YES<br> anon_other_write_enable=YES<br>重启服务<br>systemctl restart vsftpd  </p>
<h5 id="这样这个虚拟用户就可以在这个文件夹下进行读写操作了"><a href="#这样这个虚拟用户就可以在这个文件夹下进行读写操作了" class="headerlink" title="这样这个虚拟用户就可以在这个文件夹下进行读写操作了"></a>这样这个虚拟用户就可以在这个文件夹下进行读写操作了</h5><h5 id="到此就实现了基于文件验证的虚拟用户了"><a href="#到此就实现了基于文件验证的虚拟用户了" class="headerlink" title="到此就实现了基于文件验证的虚拟用户了"></a>到此就实现了基于文件验证的虚拟用户了</h5><p>###################################################################################</p>
<h2 id="实验：-实现基于MYSQL验证的vsftpd虚拟用户"><a href="#实验：-实现基于MYSQL验证的vsftpd虚拟用户" class="headerlink" title="实验： 实现基于MYSQL验证的vsftpd虚拟用户"></a>实验： 实现基于MYSQL验证的vsftpd虚拟用户</h2><h5 id="要实现把虚拟账户存在-mysql-数据库中，就要安装一个-pam-mysql-的模块，但是在-centos6-上-yum-源里还有，到-centos7-上，yum-源已经没有这个模块了，需要自己到官网上去下载。"><a href="#要实现把虚拟账户存在-mysql-数据库中，就要安装一个-pam-mysql-的模块，但是在-centos6-上-yum-源里还有，到-centos7-上，yum-源已经没有这个模块了，需要自己到官网上去下载。" class="headerlink" title="要实现把虚拟账户存在 mysql 数据库中，就要安装一个 pam_mysql 的模块，但是在 centos6 上 yum 源里还有，到 centos7 上，yum 源已经没有这个模块了，需要自己到官网上去下载。"></a>要实现把虚拟账户存在 mysql 数据库中，就要安装一个 pam_mysql 的模块，但是在 centos6 上 yum 源里还有，到 centos7 上，yum 源已经没有这个模块了，需要自己到官网上去下载。</h5><p>  下载包     pam_mysql-0.7RC1.tar.gz  </p>
<h5 id="下载完后进行解压缩"><a href="#下载完后进行解压缩" class="headerlink" title="下载完后进行解压缩"></a>下载完后进行解压缩</h5><p>tar xvf pam_mysql-0.7RC1.tar.gz </p>
<h5 id="解压缩后会生成一个文件夹"><a href="#解压缩后会生成一个文件夹" class="headerlink" title="解压缩后会生成一个文件夹"></a>解压缩后会生成一个文件夹</h5><p>  pam_mysql-0.7RC1  </p>
<h5 id="然后-cd-到-pam-mysql-0-7RC1-这个目录下进行编译"><a href="#然后-cd-到-pam-mysql-0-7RC1-这个目录下进行编译" class="headerlink" title="然后 cd 到 pam_mysql-0.7RC1 这个目录下进行编译"></a>然后 cd 到 pam_mysql-0.7RC1 这个目录下进行编译</h5><h5 id="先装开发包组以及各种包"><a href="#先装开发包组以及各种包" class="headerlink" title="先装开发包组以及各种包"></a>先装开发包组以及各种包</h5><p>yum groupinstall “development tools”   </p>
<p>yum install mariadb-server mariadb-devel pam-devel</p>
<h5 id="装完后进行编译-pam-mysql-模块，指定编译完数据存放在-lib64-security-目录下。"><a href="#装完后进行编译-pam-mysql-模块，指定编译完数据存放在-lib64-security-目录下。" class="headerlink" title="装完后进行编译 pam_mysql 模块，指定编译完数据存放在 /lib64/security 目录下。"></a>装完后进行编译 pam_mysql 模块，指定编译完数据存放在 /lib64/security 目录下。</h5><p>. /configure –with-pam-mods-dir=/lib64/security  </p>
<p>make -j 4 &amp;&amp; make install  </p>
<h5 id="编译完后连接数据库进行相关配置"><a href="#编译完后连接数据库进行相关配置" class="headerlink" title="编译完后连接数据库进行相关配置"></a>编译完后连接数据库进行相关配置</h5><h5 id="启动数据库mariadb"><a href="#启动数据库mariadb" class="headerlink" title="启动数据库mariadb"></a>启动数据库mariadb</h5><p>systemctl start mariadb  </p>
<h5 id="启动后连接数据库"><a href="#启动后连接数据库" class="headerlink" title="启动后连接数据库"></a>启动后连接数据库</h5><h5 id="创建一个数据库"><a href="#创建一个数据库" class="headerlink" title="创建一个数据库"></a>创建一个数据库</h5><p>create database vsftpd;  </p>
<h5 id="然后在这个数据库中添加一张表来存放虚拟用户的信息"><a href="#然后在这个数据库中添加一张表来存放虚拟用户的信息" class="headerlink" title="然后在这个数据库中添加一张表来存放虚拟用户的信息"></a>然后在这个数据库中添加一张表来存放虚拟用户的信息</h5><p>use vsftpd  </p>
<p>create table vsftpd(id int auto_increment primary key , name char(20) , pass char(50));  </p>
<h5 id="然后在这张表中添加虚拟用户账号"><a href="#然后在这张表中添加虚拟用户账号" class="headerlink" title="然后在这张表中添加虚拟用户账号"></a>然后在这张表中添加虚拟用户账号</h5><p>insert vsftpd(name,pass)   values(‘ftp1’,password(‘centos’)),(‘ftp2’,password(‘magedu’));  </p>
<h5 id="现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。"><a href="#现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。" class="headerlink" title="现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。"></a>现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。</h5><p>先创建一个用户  </p>
<p>grant all on vsftpd.* to vsftpd@’192.168.30.%’ identified by ‘centos’;  </p>
<h5 id="这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上"><a href="#这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上" class="headerlink" title="这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上"></a>这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上</h5><p>mysql -uvsftpd -pcentos -h192.168.30.7 (这块的IP地址是数据库所在的主机IP ，即便是在本机也要写上IP)  </p>
<h5 id="接下来要在-pam-配置文件中写清楚将来要以谁的身份去连接"><a href="#接下来要在-pam-配置文件中写清楚将来要以谁的身份去连接" class="headerlink" title="接下来要在 pam 配置文件中写清楚将来要以谁的身份去连接"></a>接下来要在 pam 配置文件中写清楚将来要以谁的身份去连接</h5><p>cd /etc/pam.d<br>vim vsftpd.mysql<br>   在里面添加<br> auth required pam_mysql.so user=vsftpd passwd=magedu<br>host=192.168.30.7 db=vsftpd table=vsftpd usercolumn=name<br> passwdcolumn=pass crypt=2<br> account required pam_mysql.so user=vsftpd passwd=magedu<br> host=192.168.30.7 db=vsftpd table=vsftpd usercolumn=name<br> passwdcolumn=pass crypt=2   </p>
<h5 id="接下来在-vsftpd-的主配置文件中添加信息"><a href="#接下来在-vsftpd-的主配置文件中添加信息" class="headerlink" title="接下来在 vsftpd 的主配置文件中添加信息"></a>接下来在 vsftpd 的主配置文件中添加信息</h5><p>vim /etc/vsftpd/vsftpd.conf<br>    在里面添加<br> pam_service_name=vsftpd.mysql<br> guest_enable=YES<br> guest_username=vuser<br>userlist_enable=YES<br>user_config_dir=/etc/vsftpd/vusers.d/<br>listen_ipv6=YES  </p>
<p>mkdir /etc/vsftpd/vusers.d/<br>cd /etc/vsftpd/vusers.d/<br>vim ftp1<br>  在里面添加<br>anon_upload_enable=YES<br>anon_mkdir_write_enable=YES<br> anon_other_write_enable=YES   </p>
<h5 id="加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。-1"><a href="#加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。-1" class="headerlink" title="加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。"></a>加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。</h5><p> mkdir /data/ftp/upload<br>setfacl -m u:vuser:rwx /data/ftp/upload  </p>
<h5 id="这样虚拟账号-ftp1-对这个文件夹就有写权限了。"><a href="#这样虚拟账号-ftp1-对这个文件夹就有写权限了。" class="headerlink" title="这样虚拟账号 ftp1 对这个文件夹就有写权限了。"></a>这样虚拟账号 ftp1 对这个文件夹就有写权限了。</h5><h5 id="但是-ftp1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftp2-虚拟账户连接-ftp-后家目录不是刚才-ftp1-的那个根目录，而是一个独立的根目录。"><a href="#但是-ftp1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftp2-虚拟账户连接-ftp-后家目录不是刚才-ftp1-的那个根目录，而是一个独立的根目录。" class="headerlink" title="但是 ftp1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftp2 虚拟账户连接 ftp 后家目录不是刚才 ftp1  的那个根目录，而是一个独立的根目录。"></a>但是 ftp1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftp2 虚拟账户连接 ftp 后家目录不是刚才 ftp1  的那个根目录，而是一个独立的根目录。</h5><p> 先创建一个文件夹<br> mkdir /data2/ftp<br>这样 虚拟用户 ftp2 连接后根目录就是 /data2/ftp  这个目录了。  </p>
<h5 id="当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。-1"><a href="#当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。-1" class="headerlink" title="当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。"></a>当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。</h5><p> 先创建一个文件夹,然后给上权限,注意这儿给权限的用户是映射的那个系统账号哦</p>
<p>mkdir /data2/ftp/upload<br>setfacl -m u:vuser:rwx upload  </p>
<p>vim ftp2<br>   在里面添加<br> local_root=/ftproot<br>anon_upload_enable=YES<br>anon_mkdir_write_enable=YES<br> anon_other_write_enable=YES   </p>
<p>最后然后重启服务<br>systemctl restart vsftpd  </p>
<p>就可以进行测试使用了  </p>
<h2 id="实验：-实现基于-php-fpm的LAMP，并搭建以-NFS-服务器共享出来的-wordpress"><a href="#实验：-实现基于-php-fpm的LAMP，并搭建以-NFS-服务器共享出来的-wordpress" class="headerlink" title="实验： 实现基于 php-fpm的LAMP，并搭建以 NFS 服务器共享出来的 wordpress"></a>实验： 实现基于 php-fpm的LAMP，并搭建以 NFS 服务器共享出来的 wordpress</h2><p>首先准备四台主机，192.168.30.7    192.168.30.17    192.168.30.27     192.168.30.6  </p>
<p>先来规划一下      192.168.30.7   这台主机上来做第一个 外部服务器<br>对这台主机进行配置  </p>
<p> 先装相应的包<br>yum install httpd php-fpm php-mysql  </p>
<p>然后拿 192.168.30.17 这台主机来做第二个 外部服务器<br>进行配置，先装包<br>yum install httpd php-fpm php-mysql  </p>
<p>用 192.168.30.27 这台主机来做 NFS 服务器  </p>
<p>先创建一个文件夹<br>mkdir /data/  </p>
<p>然后把 wordpress 源码包下载到这台主机上来  </p>
<p>下载包       wordpress-4.9.4-zh_CN.tar.gz  </p>
<p>然后解压缩并解到 /data/ 目录下  </p>
<p>tar xvf wordpress-4.9.4-zh_CN.tar.gz  -C /data  </p>
<p>然后就在 /data/ 目录下生成一个   wordpress 的文件夹 </p>
<p>接下来把这个文件夹共享出去  </p>
<p>修改 nfs 的配置文件       vim /etc/exports<br>    在里面添加       /data/wordpress          192.168.30.0/24(rw) </p>
<p>然后启动服务        </p>
<p> systemctl start nfs-server  </p>
<p>然后用 192.168.30.6 主机来搭建后端数据库  </p>
<p>先装包<br>yum install mysql-server      (因为这台主机是 centos 6 ，所以安装包跟7 不一样)  </p>
<p>启动服务<br>service  mysqld start  </p>
<p>连接进数据库中并创建一个数据库<br>create database wpdb;  </p>
<p>创建一个用户<br> grant all on wpdsb.* to wpuser@’192.168.1.%’ identified by ‘centos’; </p>
<p>重新加载数据库    </p>
<p>flush privileges;  </p>
<p>接下来回到 192.168.30.7 主机上把nfs 共享出来的目录挂载在本机上 </p>
<p>mount 192.168.30.27:/data/wordpress  /var/www/html/  </p>
<p>但是要永久挂载还得写入配置文件中      vim /etc/fstab  </p>
<p>192.168.30.27:/data/wordpress  /var/www/html/          nfs       defaults        0   0  </p>
<p>然后修改 httpd 的配置文件        vim /etc/httpd/conf.d/fcgi.conf<br>  在里面添加<br>   DirectoryIndex index.php<br>   ProxyRequests Off<br>    ProxyPassMatch ^/(.*.php)$ fcgi://127.0.0.1:9000/var/www/html/$1  </p>
<p>   最后启动服务   </p>
<p>systemctl start httpd php-fpm                     </p>
<p>在 192.168.30.17 这台主机上也把 nfs 共享出来的目录挂载在本机上<br>mount 192.168.30.27:/data/wordpress  /var/www/html/<br>但是要永久挂载还得写入配置文件中      vim /etc/fstab<br>192.168.30.27:/data/wordpress  /var/www/html/          nfs       defaults      0   0<br>然后修改 httpd 的配置文件        vim /etc/httpd/conf.d/fcgi.conf<br>  在里面添加<br>   DirectoryIndex index.php<br>   ProxyRequests Off<br>    ProxyPassMatch ^/(.*.php)$ fcgi://127.0.0.1:9000/var/www/html/$1 </p>
<p>  最后启动服务<br>   systemctl start httpd php-fpm   </p>
<p>接下来回到 192.168.30.27   这台主机上 对 wordpress 进行配置 </p>
<p>先 cd /data/wordpress  </p>
<p>复制配置文件  </p>
<p>cp wp-config-sample.php  wp-config.php  </p>
<p>然后修改配置文件       vim wp-config.php  </p>
<p>修改内容为下  </p>
<p>  <img src="http://i2.bvimg.com/657107/47c2a545ffefd3a8.png" alt="Markdown"></p>
<p>   接下来就可以拿浏览器进行分别访问两个外部服务器了，如果显示出 wordpress 界面表示成功。  </p>
<p>然后在一个 wordpress 界面安装信息，登录成功并写一篇文章，然后在浏览器上输入另一个外部服务器的 IP ，用同样的账户登录后如果显示出写的文章表示实验成功。</p>
<h2 id="实验：-实现-SAMBA-服务"><a href="#实验：-实现-SAMBA-服务" class="headerlink" title="实验： 实现 SAMBA 服务"></a>实验： 实现 SAMBA 服务</h2><p>先装包     yum install samba  </p>
<p>装好后查看下包结构  </p>
<p>/usr/lib/systemd/system/smb.service         #   这是主服务  </p>
<p>/usr/sbin/samd       #   主程序  </p>
<p>/etc/samba/smb.conf      #  主配置文件  </p>
<p>samba-client       #  客户端服务  </p>
<p>smbclient    客户端工具  </p>
<p>smbclient  -L “IP”     ：  可以查看某台主机的共享文件夹  </p>
<p>  smb 服务也可以和 nfs 服务一样，客户端都可以把服务器共享出来的目录挂载到本机上，不同的是， smb 服务需要身份验证，必须输入用户口令才能挂载。  </p>
<p>  如： mount -o username=test,password=123 //192/168/30.1/tools /mnt/win  </p>
<p>   表示把 windows 服务器 192.168.30.1 上的 tools 目录挂载到本机的 /mnt/win 文件夹下  </p>
<p>当然这样只是临时挂载，要想永久挂载还得写进配置文件    vim /etc/fstab<br>//192/168/30.1/tools    /mnt/win       cifs         username=test,password=123      0  0  </p>
<p>但是这是个所有人可读文件，这样把用户口令写进配置文件里太不安全了。可以换种方式书写 ，如：  </p>
<p> //192/168/30.1/tools    /mnt/win       cifs         credentials=/etc/user.txt   0   0  </p>
<p>然后把用户口令存放在这个文件中     vim /etc/user.txt  </p>
<p>  username=test<br>  password=123  </p>
<p>然后给这个文件设上权限<br>  chmod 600 /etc/user.txt  </p>
<p>这样就保证安全了。 </p>
<p>以上是 smb 客户端如何挂载情况。  </p>
<p>接下来查看下 smb 服务器端。 </p>
<p>在前面我们已经装好包了，现在启动服务 </p>
<p>systemctl start smb  </p>
<p>启动服务后，会打开 445   139  两个端口  </p>
<p>现在服务启动了，就可以拿客户端连接了，但是连接还需要用户口令，现在还没有创建 smb 用户。  </p>
<p>还需用给 smb 服务创建自己的虚拟账号，但是有一个要求， smb 账户还必须是 linux 系统用户。那还必须把  linux 系统 账户变成  smb  账号。  </p>
<p>先创建账号  </p>
<p>useradd -s /sbin/nologin smb1<br>useradd -s /sbin/nologin smb2<br>useradd -s /sbin/nologin smb3  </p>
<p>现在这些账号还是 linux 系统账号，还不是 smb 账号，需要把这些账号变成 smb 账号。</p>
<p>改变账户  </p>
<p>smbpasswd -a smb1 smb2 smb3  </p>
<p>这样就把linux 系统账户变成 smb 账户了  </p>
<p> pdbedit -L    ：这个命令可以查看目前所拥有的所有 smb 账号  </p>
<p>smb 用户创建好后存放在 smb 数据库中，smb 的数据库是 :<br>/var/lib/samba/private/passwd.tdb<br>有了 smb 用户以后就可以拿客户端进行访问 服务器 IP 了。  </p>
<p>如果没有没有共享目录，客户端访问时会显示你访问这个 smb   用户的家目录中的数据  </p>
<p>如果现在有一个文件夹  /data/tools     ，现在想把这个文件夹共享出去，就必须修改 smb 服务的配置文件了  </p>
<p>vim /etc/samba/smb.conf<br>在里面添加<br>hosts allow = “IP”<br>  表示限定哪些主机访问  </p>
<p>log file = /var/log/samba/log.%I<br>  表示日志文件  ， % I 表示访问的日志以访问主机的IP 为后缀<br>  但是光添加这个文件，日志还不能记录到这个文件中，还需用添加内容。    </p>
<p>  log level = 2<br>  表示日志记录级别，添加这条再有访问就会记录到文件中。  </p>
<p>max log size = 50<br> 表示日志记录的大小，单位为 KB ，达到这么大以后就会把以前的日志覆盖，如果不加设定，日志文件会越来越大<br>  以上配置都是在配置文件中的 【global】 语句块下添加  </p>
<p>接下来把自己创建的一个目录共享出去，比如上面说的 /data/tools 文件夹<br>一样在配置文件中添加内容，  vim /etc/samba/smb.conf  </p>
<p>添加新的语句块<br>[share]                     #   表示共享出去的名称<br>comment=samba share dir         #   描述信息，加不加都可以<br>path=/data/tools                 #   共享的真实路径  </p>
<p>如果就在配置文件中添加以上信息，在客户端输入用户口令是可以连接到 smb 服务的，但是不能给里面上传文件，还得设有权限。  </p>
<p>先要给共享目录上传文件，必须加上权限<br>writable= yes            #     表示有写权限<br>但是按道理是可以访问了，实际还不能访问，因为 /data/tools   文件夹还没有对 other 写权限，所以不能写。     要想有写权限，不但配置文件中添加相应权限，还要对共享文件夹添加相应的权限，这样客户端才能进行上传或下载。<br>注意修改配置文件后要重启服务           systemctl restart smb  </p>
<p>还有如果在配置文件中添加         public=yes<br>   默认为 NO        就表示客户端连接 smb 服务端可以匿名登录，不用输入用户口令就可以连接到服务器上，连接上还可以在里面进行上传下载，但是上传上来的文件所有者所属组都是 nobody  用户。当然这样就不太安全了，在生产中如果没有特定需求，不要添加此项。  </p>
<p> 如果在配置文件把 public=no ，就表示共享目录只有被验证过的 smb 用户才能够访问 ，比如，现在就只有 smb1  smb2   smb3   这三个用户可以访问， 那么现在要求来了，只想限定特定用户能够访问，如，现在只想 smb1    smb3   两个用户可以访问，怎么解决？  </p>
<p>   还是在配置文件里添加       valid users=smb1  smb3<br>修改完记得重启服务  </p>
<p>这样 smb1  smb3  还可以正常访问，smb2 就不能连接了  </p>
<p>  这种方式用户少的话还可以，设定的用户多的话就不方便了，还可以换种方式，把允许连接的用户放到一个组里，然后在配置文件中把 valid users 的值设为这个组就可以了。    </p>
<p>   比如 ，   先创建一个组<br>           groupadd staff<br>         然后把允许连接的用户放到这个组中<br>           usermod  -aG staff smb1<br>           usermod -aG staff smb2<br>           然后在配置文件中添加<br>           valid users=+staff<br> 这样就表示只有这个组里的用户才能连接服务  </p>
<p>还有一种要求，就是想实现有些用户连接进来只能读，有些用户连接进来能读能写，怎么实现？  </p>
<p> 就是设定所有用户能读，再把允许有写权限的用户放在一个组中，然后设定特定权限即可。 如下：<br>修改配置文件<br>   read only = ye s       #  表示所有人都可以读但不能上传，但能下载。<br>   write list =+staff        #  表示只有这个组里的用户才有写权限  </p>
<p>现在还可以这样做，让访问的用户访问同样的 UNC 路径看到的内容不一样，比如，现在有用户 smb1   smb2   smb3   ， 要求 smb1 访问时看到的是默认的共享文件夹 /data/tools    ， 让 smb2 用户访问时看到的是专门为 smb2 用户设定的内容  ， 让 smb3 用户访问时也看到专门为 smb3 用户设定的内容，但是还要保证访问时 UNC 路径不变，跟其他普通用户一样，还可以使各自的权限不同，怎么来解决？  </p>
<p>先创建 各自的文件夹<br>  mkdir /data/smb2<br>  mkdir /data/smb3<br>   touch /data/smb2/smb2.txt<br>   touch  /data/smb3/smb3.txt<br>       当然原来的 /data/tools 文件还在<br>然后给专门设定的用户设定自己的配置文件，并在主配置文件中添加相关内容。比如：<br>             在主配置文件 【global】中添加<br> config file = /etc/samba/conf.d/%U<br>然后把文件夹创建出来<br>  mkdir /etc/samba/conf.d/<br>cd /etc/samba/conf.d/<br>vim smb2<br>在里面添加<br> [share]<br> path=/data/smb2        # 表示自己的路径<br>writeable=yes             #  表示有写权限<br>vim smb3<br>[share]<br> path=/data/smb3            #  表示自己的路径  </p>
<p>注意还要给 /data/   目录加权限   ， chmod -R 777 /data/ </p>
<p>最后重启服务    systemctl restart smb  </p>
<p>这样访问时，访问 smb1 看到的是 默认的共享目录 /data/tools  , 访问 smb2,smb3 看到的是各自的目录，并且 只有 smb2 用户有写权限，可以上传文件。  </p>
<h5 id="这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。"><a href="#这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。" class="headerlink" title="这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。"></a>这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。</h5><h2 id="实验：-实现多用户的-smb-挂载"><a href="#实验：-实现多用户的-smb-挂载" class="headerlink" title="实验：   实现多用户的 smb 挂载"></a>实验：   实现多用户的 smb 挂载</h2><p>现在服务器有 四个 smb 账号， smb1  smb2   smb3   smbshare<br> smb1  和  smb3 在 staff 组中，具有写权限  </p>
<p>共享的目录是 /data/tools   </p>
<p>在配置文件中添加了<br>                                      [share]                     #   表示共享的 名称<br>                                       path=/data/tools         #  表示共享的目录<br>                                        write list= +staff  </p>
<p>来到客户端  </p>
<p>先创建跟服务端 smb 用户同名的用户<br>useradd smb1<br>useradd smb2<br>useradd smb3  </p>
<p>然后挂载时不拿这三个用户挂载，而是拿 smbshare 用户挂载<br>mount -o username=smbshare,password=centos,multiuser //192.168.30.7/share /mnt  </p>
<p>挂载完了以后访问时切换创建的这三个账户来进行访问<br>如     su - smb1</p>
<p> 切过来以后还不能直接访问，还需要验证<br>cifscreds add 192.168.30.7(服务器端的地址)<br> 表示验证身份的，验证这个用户跟服务器端的用户是同一个用户，并且输入服务器端这个用户的口令。<br>输完了以后就可以进行访问数据了    如   ls /mnt  </p>
<p>但是每个用户访问都要切换身份在经过验证身份来进行访问的。  </p>
<p>可以发现  smb1  和   smb3  有写权限， smb2  没有，并且各自用户创建的文件所有者所属组是各自用户。  </p>
<p>这就是多用户挂载，挂只用挂一次，然后切换不同身份进行访问，并且具有不同的权限。  </p>
<p>注意： 在生产中要想永久挂载还得写进配置文件中    /etc/fstal<br>格式为 ：  </p>
<p> //192.168.30.7/share    /mnt   cifs       username=smbshare,password=centos,multiuser    0   0</p>
</div><div class="tags"><a href="/tags/Linux/">Linux</a><a href="/tags/共享服务/">共享服务</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/08/19/lvs 详细介绍/" class="pre">lvs 详细介绍</a><a href="/2017/06/20/网络文件共享服务：FTP    NFS   SAMBA/" class="next">网络文件共享服务：FTP    NFS   SAMBA</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Inhalte</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验：-实现基于文件验证的-vsftpd-虚拟用户"><span class="toc-text">实验： 实现基于文件验证的 vsftpd 虚拟用户</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#先创建一个存放虚拟用户的账号密码的文件-vim-etc-vsftpd-vsftpusers"><span class="toc-text">先创建一个存放虚拟用户的账号密码的文件      vim /etc/vsftpd/vsftpusers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这个文件中奇数行是虚拟账户，偶数行是密码。"><span class="toc-text">这个文件中奇数行是虚拟账户，偶数行是密码。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建完后这个文件还不能直接使用，还要把它转化成-Berkeley-db-数据库格式的文件。"><span class="toc-text">创建完后这个文件还不能直接使用，还要把它转化成 Berkeley db 数据库格式的文件。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建完后会生成一个-vsftpusers-db-文件，这个文件是二进制格式的。"><span class="toc-text">创建完后会生成一个 vsftpusers.db 文件，这个文件是二进制格式的。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#然后对这个文件修改权限"><span class="toc-text">然后对这个文件修改权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这样以前那个文件就没用了，可以把删除掉，避免数据流出。"><span class="toc-text">这样以前那个文件就没用了，可以把删除掉，避免数据流出。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。"><span class="toc-text">现在虚拟账号创建好了，还要创建一个系统账号，然后把创建好的虚拟账号映射到这个系统账号上，这样才能进行访问。并且创建家目录，这个家目录将来就用来存放虚拟账号的数据。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#然后把家目录创建出来，并修改权限-因为ftp-家目录系统是不支持有写权限的。"><span class="toc-text">然后把家目录创建出来，并修改权限,因为ftp 家目录系统是不支持有写权限的。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#接下来要调用-vsftpuser-db-这个数据库时还要在-pam-模块配置文件中创建一个文件"><span class="toc-text">接下来要调用 vsftpuser.db  这个数据库时还要在 pam 模块配置文件中创建一个文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pam-模块配置文件创建好了但是-系统并不知道有这个文件，所以还要在-ftp-服务的主配置文件中添加相应内容。"><span class="toc-text">pam 模块配置文件创建好了但是 系统并不知道有这个文件，所以还要在 ftp 服务的主配置文件中添加相应内容。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#接下来还要给虚拟账号创建各自的独立的配置文件"><span class="toc-text">接下来还要给虚拟账号创建各自的独立的配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#接下来创建虚拟用户各自的配置文件-在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。"><span class="toc-text">接下来创建虚拟用户各自的配置文件 ,在里面设置相应的权限。但是在这注意了，这里的这个文件名一定要和虚拟账户的名字一样。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。"><span class="toc-text">加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这样虚拟账号-ftpuser1-对这个文件夹就有写权限了-。"><span class="toc-text">这样虚拟账号 ftpuser1 对这个文件夹就有写权限了 。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#但是-ftpuser1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftpuser2-虚拟账户连接-ftp-后家目录不是刚才-ftpuser1-的那个根目录，而是一个独立的根目录。"><span class="toc-text">但是 ftpuser1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftpuser2 虚拟账户连接 ftp 后家目录不是刚才 ftpuser1  的那个根目录，而是一个独立的根目录。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。"><span class="toc-text">当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#先创建一个文件夹-然后给上权限-注意这儿给权限的用户是映射的那个系统账号哦"><span class="toc-text">先创建一个文件夹,然后给上权限,注意这儿给权限的用户是映射的那个系统账号哦</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这样这个虚拟用户就可以在这个文件夹下进行读写操作了"><span class="toc-text">这样这个虚拟用户就可以在这个文件夹下进行读写操作了</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#到此就实现了基于文件验证的虚拟用户了"><span class="toc-text">到此就实现了基于文件验证的虚拟用户了</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验：-实现基于MYSQL验证的vsftpd虚拟用户"><span class="toc-text">实验： 实现基于MYSQL验证的vsftpd虚拟用户</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#要实现把虚拟账户存在-mysql-数据库中，就要安装一个-pam-mysql-的模块，但是在-centos6-上-yum-源里还有，到-centos7-上，yum-源已经没有这个模块了，需要自己到官网上去下载。"><span class="toc-text">要实现把虚拟账户存在 mysql 数据库中，就要安装一个 pam_mysql 的模块，但是在 centos6 上 yum 源里还有，到 centos7 上，yum 源已经没有这个模块了，需要自己到官网上去下载。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#下载完后进行解压缩"><span class="toc-text">下载完后进行解压缩</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#解压缩后会生成一个文件夹"><span class="toc-text">解压缩后会生成一个文件夹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#然后-cd-到-pam-mysql-0-7RC1-这个目录下进行编译"><span class="toc-text">然后 cd 到 pam_mysql-0.7RC1 这个目录下进行编译</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#先装开发包组以及各种包"><span class="toc-text">先装开发包组以及各种包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#装完后进行编译-pam-mysql-模块，指定编译完数据存放在-lib64-security-目录下。"><span class="toc-text">装完后进行编译 pam_mysql 模块，指定编译完数据存放在 /lib64/security 目录下。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#编译完后连接数据库进行相关配置"><span class="toc-text">编译完后连接数据库进行相关配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#启动数据库mariadb"><span class="toc-text">启动数据库mariadb</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#启动后连接数据库"><span class="toc-text">启动后连接数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建一个数据库"><span class="toc-text">创建一个数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#然后在这个数据库中添加一张表来存放虚拟用户的信息"><span class="toc-text">然后在这个数据库中添加一张表来存放虚拟用户的信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#然后在这张表中添加虚拟用户账号"><span class="toc-text">然后在这张表中添加虚拟用户账号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。"><span class="toc-text">现在数据库就创建好了，将来就可以读取数据库的信息了，但是现在还得要一个能够连接这个数据库访问表中的信息的用户。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上"><span class="toc-text">这样连接数据库的用户就创建好了，一般在生产中建议测试一下，看能不能连接上</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#接下来要在-pam-配置文件中写清楚将来要以谁的身份去连接"><span class="toc-text">接下来要在 pam 配置文件中写清楚将来要以谁的身份去连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#接下来在-vsftpd-的主配置文件中添加信息"><span class="toc-text">接下来在 vsftpd 的主配置文件中添加信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。-1"><span class="toc-text">加完之后这个用户还不能正常使用，因为他对整个家目录没有写全限，但是根目录又不能加写权限，所以要在根目录下创建一个文件夹，然后给用户这个文件夹的权限，注意，在这这个用户不是虚拟用户，而是虚拟用户映射的那个系统用户。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#这样虚拟账号-ftp1-对这个文件夹就有写权限了。"><span class="toc-text">这样虚拟账号 ftp1 对这个文件夹就有写权限了。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#但是-ftp1-可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求-ftp2-虚拟账户连接-ftp-后家目录不是刚才-ftp1-的那个根目录，而是一个独立的根目录。"><span class="toc-text">但是 ftp1 可以正常使用了，用户数据库文件中的其他虚拟用户还不能正常使用，那么现在要求这样，要求 ftp2 虚拟账户连接 ftp 后家目录不是刚才 ftp1  的那个根目录，而是一个独立的根目录。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。-1"><span class="toc-text">当然现在这个用户还没有写权限，我们可以跟上面一样给他写权限即可。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验：-实现基于-php-fpm的LAMP，并搭建以-NFS-服务器共享出来的-wordpress"><span class="toc-text">实验： 实现基于 php-fpm的LAMP，并搭建以 NFS 服务器共享出来的 wordpress</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验：-实现-SAMBA-服务"><span class="toc-text">实验： 实现 SAMBA 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。"><span class="toc-text">这样就实现了，访问同样的路径，不同的用户看到不同的目录并且具有不同的权限。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验：-实现多用户的-smb-挂载"><span class="toc-text">实验：   实现多用户的 smb 挂载</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/Nginx 各种实验演示/">Nginx各种实验演示</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/Nginx 详细介绍/">Nginx 详细介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/日志管理介绍/">日志管理介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/Linux 防火墙各种规则实战应用/">Linux 防火墙各种规则实战应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/keepalived高可用/">Ansible</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/15/memcache  缓存原理介绍/">memcache  缓存原理介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/08/tomcat 各种架构实验演示/">tomcat 各种架构实验演示</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/05/浅谈 tomcat 原理/">浅谈 tomcat 原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/25/Varnish 缓存服务器介绍/">Varnish 缓存服务器介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/keepalived 各种高可用实战演练/">keepalived 各种高可用实战演练</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"><a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/haproxy/" style="font-size: 15px;">haproxy</a> <a href="/tags/LAMP/" style="font-size: 15px;">LAMP</a> <a href="/tags/用户组/" style="font-size: 15px;">用户组</a> <a href="/tags/权限管理/" style="font-size: 15px;">权限管理</a> <a href="/tags/练习题/" style="font-size: 15px;">练习题</a> <a href="/tags/MYSQL/" style="font-size: 15px;">MYSQL</a> <a href="/tags/DNS/" style="font-size: 15px;">DNS</a> <a href="/tags/文件系统/" style="font-size: 15px;">文件系统</a> <a href="/tags/su和sudo/" style="font-size: 15px;">su和sudo</a> <a href="/tags/自动化/" style="font-size: 15px;">自动化</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/DHCP/" style="font-size: 15px;">DHCP</a> <a href="/tags/varnish/" style="font-size: 15px;">varnish</a> <a href="/tags/keepalied/" style="font-size: 15px;">keepalied</a> <a href="/tags/memcache/" style="font-size: 15px;">memcache</a> <a href="/tags/lvs/" style="font-size: 15px;">lvs</a> <a href="/tags/rpm/" style="font-size: 15px;">rpm</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/共享服务/" style="font-size: 15px;">共享服务</a> <a href="/tags/自动化安装/" style="font-size: 15px;">自动化安装</a> <a href="/tags/基本命令/" style="font-size: 15px;">基本命令</a> <a href="/tags/CA/" style="font-size: 15px;">CA</a> <a href="/tags/dns/" style="font-size: 15px;">dns</a> <a href="/tags/sed/" style="font-size: 15px;">sed</a> <a href="/tags/mini系统/" style="font-size: 15px;">mini系统</a> <a href="/tags/进程管理、计划任务/" style="font-size: 15px;">进程管理、计划任务</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archiv</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">RSS</a> |  <a href="/about/">Über</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">John Doe.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>