<!DOCTYPE html>
<html>
    <!-- title -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="John Doe">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="John Doe">
    <meta name="keywords" content="Hexo | John Doe">
    <meta name="description" content="">
    <meta name="Cache-Control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Linux分区信息与管理文件系统 · 李登峰</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s 1;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= /css/style.css?v=20180630 as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= /css/mobile.css?v=20180630 media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >博客</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Linux分区信息与管理文件系统</a>
            </div>
    </div>
    
    <a class="home-link" href=/>博客</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style=








height:50vh;

>
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            Linux分区信息与管理文件系统
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "Linux">Linux</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "文件系统">文件系统</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count">13,498</span> / Reading time: <span class="post-count">61 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2017/04/15</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div> 
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><p>分区是为了在逻辑上将某些柱面隔开形成边界。它是以柱面为单位来划分的，首先划分外圈柱面，然后不断向内划分。  </p>
<p>由于读写越外圈磁道中的数据比越内圈更快，所以第一个分区在读写性能上比后面的分区更好。在Windows操作系统上，C盘的速度是最快的，越后面的区越慢就是这个原因。  </p>
<p>在磁盘数据量非常大的情况下，划分分区的好处是扫描块位图等更快速：不用再扫描整块磁盘的块位图，只需扫描对应分区的块位图。<br><a id="more"></a></p>
<h4 id="分区方法-MBR和GPT"><a href="#分区方法-MBR和GPT" class="headerlink" title="分区方法(MBR和GPT)"></a>分区方法(MBR和GPT)</h4><p>MBR格式的磁盘中，会维护磁盘第一个扇区——MBR扇区，在该扇区中第446字节之后的64字节是分区表，每个分区占用16字节，所以限制了一块磁盘最多只能有4个主分区(Primary,P)，如果多于4个区，只能将主分区少于4个，通过建立扩展分区(Extend,E)，然后在扩展分区建立逻辑分区(Logical,L)的方式来突破4个分区的限制。  </p>
<p>在Linux中，MBR格式的磁盘主分区号从1-4，扩展分区号从2-4，逻辑分区号从5-15，也就是最大限制是15个分区。  </p>
<p>例如，一块盘想分成6个分区，可以：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1P+5L：sda1+sda5+sda6+sda7+sda8+sda9</span><br><span class="line">2P+4L：sda1+sda2+sda5+sda6+sda7+sda8</span><br><span class="line">3P+3L：sda1+sda2+sda3+sda5+sda6+sda7</span><br></pre></td></tr></table></figure>
<p>而GPT格式突破了MBR的限制，它不再限制只能存储4个分区表条目，而是使用了类似MBR扩展分区表条目的格式，它允许有128个主分区，这也使得它可以对超过2TB的磁盘进行分区。  </p>
<h4 id="MBR和GPT分区表信息"><a href="#MBR和GPT分区表信息" class="headerlink" title="MBR和GPT分区表信息"></a>MBR和GPT分区表信息</h4><p>在MBR格式分区表中，MBR扇区占用512个字节，前446个字节是主引导记录，即boot loader。中间64字节记录着分区表信息，每个主分区信息占用16字节，因此最多只能有4个主分区，最后2个字节是有效标识位。如果使用扩展分区，则扩展分区对应的16字节记录的是指向扩展分区中扩展分区表的指针。</p>
<p><img src="https://images2015.cnblogs.com/blog/733013/201706/733013-20170619142418132-168371863.png" alt="image"><br>在MBR磁盘上，分区和启动信息是保存在一起的，如果这部分数据被覆盖或破坏，只能重建MBR。而GPT在整个磁盘上保存多个这部分信息的副本，因此它更为健壮，并可以恢复被破坏的这部分信息。GPT还为这些信息保存了循环冗余校验码(CRC)以保证其完整和正确，如果数据被破坏，GPT会发现这些破坏，并从磁盘上的其他地方进行恢复。  </p>
<p>下面是GPT格式的分区表信息，大致约占17个字节。<br><img src="https://images2015.cnblogs.com/blog/733013/201706/733013-20170619142451632-8238306.png" alt="image"><br>EFI部分可以分为4个区域：EFI信息区(GPT头)、分区表、GPT分区区域和备份区域。  </p>
<p>EFI信息区(GPT头)：起始于磁盘的LBA1，通常也只占用这个单一扇区。其作用是定义分区表的位置和大小。<br>GPT头还包含头和分区表的校验和，这样就可以及时发现错误。  </p>
<p>分区表：分区表区域包含分区表项。这个区域由GPT头定义，一般占用磁盘LBA2～LBA33扇区，每扇区可存储4个主分区的分区信息，所以共能分128个主分区。分区表中的每个分区项由起始地址、结束地址、类型值、名字、属性标志、GUID值组成。分区表建立后，128位的GUID对系统来说是唯一的。  </p>
<p>GPT分区：最大的区域，由分配给分区的扇区组成。这个区域的起始和结束地址由GPT头定义。  </p>
<p>备份区：备份区域位于磁盘的尾部，包含GPT头和分区表的备份。它占用GPT结束扇区和EFI结束扇区之间的33个扇区。其中最后一个扇区用来备份1号扇区的EFI信息，其余的32个扇区用来备份LBA2～LBA33扇区的分区表。  </p>
<h4 id="添加磁盘"><a href="#添加磁盘" class="headerlink" title="添加磁盘"></a>添加磁盘</h4><p>正常情况下，添加磁盘后需要重启系统才能被内核识别，在/dev/下才有对应的设备号，使用fdisk -l才会显示出来。但是有时候不方便重启，所以下面介绍一种磁盘热插拔方式。更多热插和热拔方法见我的另一篇文章：Linux上磁盘热插拔。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# ls /sys/class/scsi_host/  # 查看主机scsi总线号</span><br><span class="line">host0  host1  host2</span><br></pre></td></tr></table></figure>
<p>重新扫描scsi总线以热插拔方式添加新设备。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host0/scan</span><br><span class="line">[root@node1 ~]# echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host1/scan</span><br><span class="line">[root@node1 ~]# echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host2/scan</span><br><span class="line">[root@node1 ~]# fdisk -l      # 再查看就有了</span><br></pre></td></tr></table></figure>
<p>如果scsi_host目录系很多hostN目录，则使用循环来完成。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi scsi_host]# ls /sys/class/scsi_host/</span><br><span class="line">host0   host11  host14  host17  host2   host22  host25  host28  host30  host4  host7</span><br><span class="line">host1   host12  host15  host18  host20  host23  host26  host29  host31  host5  host8</span><br><span class="line">host10  host13  host16  host19  host21  host24  host27  host3   host32  host6  host9</span><br><span class="line"></span><br><span class="line">[root@xuexi scsi_host]# for i in /sys/class/scsi_host/host*/scan;do echo &quot;- - -&quot; &gt;$i;done</span><br></pre></td></tr></table></figure>
<h4 id="使用fdisk分区工具"><a href="#使用fdisk分区工具" class="headerlink" title="使用fdisk分区工具"></a>使用fdisk分区工具</h4><p>fdisk工具用来分MBR磁盘上的区。要分GPT磁盘上的区，可以使用gdisk。parted工具对这两种格式的磁盘分区都支持。  </p>
<p>如果一个存储设备已经分过区，那么它可能是mbr格式的，也可能是gpt格式的，如果已经是mbr格式的，则只能继续使用fdisk进行分区，如果已经是gpt格式的，则只能使用gdisk进行分区。当然，无论什么格式的都可以使用parted进行分区，只不过也只能划分和已存在分区格式一样的分区，因为无论何种格式的分区，它的分区表和分区标识是已经固定的。  </p>
<p>使用fdisk分区，它只能实现MBR格式的分区。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# fdisk /dev/sdb   # sdb后没加数字</span><br><span class="line">Command (m for help): m          # 输入m查看可用命令帮助</span><br><span class="line">Command action                  </span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition        # 删除分区，如果删除扩展分区同时会删除里面的逻辑分区</span><br><span class="line">   l   list known partition types # 列出分区类型</span><br><span class="line">   m   print this menu           # 显示帮助信息</span><br><span class="line">   n   add a new partition       # 创建新分区</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   print the partition table      # 输出分区信息</span><br><span class="line">   q   quit without saving changes    # 不保存退出</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition&apos;s system id  # 修改分区类型</span><br><span class="line">   u   change display/entry units</span><br><span class="line">   v   verify the partition table</span><br><span class="line">   w   write table to disk and exit    # 保存分区信息并退出</span><br><span class="line">   x   extra functionality (experts only)</span><br></pre></td></tr></table></figure>
<p>新建第一个主分区：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Command (m for help): n                   # 添加分区</span><br><span class="line">Command action</span><br><span class="line">   e   extended                           # 添加扩展分区</span><br><span class="line">   p   primary partition (1-4)            # 添加主分区</span><br><span class="line">p                                         # 输入p来创建第一个主分区</span><br><span class="line">Partition number (1-4): 1                 # 输入分区号，从1开始</span><br><span class="line">First cylinder (1-1305, default 1):     # 输入柱面号，不输人默认是1</span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-1305, default 1305): +2G  # 给第一个主分区/dev/sdb1分2G，也可以使用柱面号来指定大小。</span><br><span class="line">Command (m for help): p     # 第一个分区结束，p查看下已分区信息</span><br><span class="line"> </span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">255 heads, 63 sectors/track, 1305 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x2d8d64eb</span><br><span class="line"> </span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         262     2104483+  83  Linux</span><br></pre></td></tr></table></figure>
<p>新建扩展分区：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Command (m for help): n      # 再建一个分区</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">e      # 创建扩展分区</span><br><span class="line">Partition number (1-4): 2     # 扩展分区号为2</span><br><span class="line">First cylinder (263-1305, default 263):</span><br><span class="line">Using default value 263</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (263-1305, default 1305): # 剩余空间全部给扩展分区</span><br><span class="line">Using default value 1305</span><br><span class="line">Command (m for help): p </span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">255 heads, 63 sectors/track, 1305 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x2d8d64eb</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         262     2104483+  83  Linux</span><br><span class="line">/dev/sdb2             263        1305     8377897+   5  Extended</span><br></pre></td></tr></table></figure>
<p>新建扩展分区：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Command (m for help): n         # 新建逻辑分区</span><br><span class="line">Command action</span><br><span class="line">   l   logical (5 or over)      # 这里不再是扩展分区标识e，只有l。</span><br><span class="line">             # 如果已有3个主分区，这里连l都没有</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">l            # 新建逻辑分区</span><br><span class="line">First cylinder (263-1305, default 263):      # 这里也不能选逻辑分区号了</span><br><span class="line">Using default value 263</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (263-1305, default 1305): +3G</span><br><span class="line">Command (m for help): p</span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">255 heads, 63 sectors/track, 1305 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x2d8d64eb</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         262     2104483+  83  Linux</span><br><span class="line">/dev/sdb2             263        1305     8377897+   5  Extended</span><br><span class="line">/dev/sdb5             263         655     3156741   83  Linux</span><br></pre></td></tr></table></figure>
<p>分区结束，保存。如果不保存，则按q。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Command (m for help): w  </span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
<p>分区的过程，实质上是划分柱面以及修改分区表。  </p>
<p>上面的fdisk操作全部是在内存中执行的，必须保存生效。保存后，内核还未识别该分区，可以查看/proc/partition目录下存在的文件，这些文件是能被内核识别的分区。运行partprobe或partx命令重新读取分区表让内核识别新的分区，内核识别后才可以格式化。而且分区结束时按w保存分区表有时候会失败，提示重启，这时候运行partprobe命令可以代替重启就生效。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# partprobe         # 执行partprobe，下面一堆信息，不理它</span><br><span class="line">Warning: WARNING: the kernel failed to re-read the partition table on /dev/sda (Device or resource busy).  As a result, it may not reflect all of your changes until after reboot.</span><br><span class="line">Warning: Unable to open /dev/sr0 read-write (Read-only file system).  /dev/sr0 has been opened read-only.</span><br><span class="line">Warning: Unable to open /dev/sr0 read-write (Read-only file system).  /dev/sr0 has been opened read-only.</span><br><span class="line">Error: Invalid partition table - recursive partition on /dev/sr0.</span><br></pre></td></tr></table></figure>
<p>也可指定在/dev/sdb上重加载分区表，省的无法读取正忙的/dev/sda磁盘，给出上面一堆信息。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# partprobe /dev/sdb</span><br></pre></td></tr></table></figure>
<p>分区之后再使用fdisk -l查看新的分区状态。  </p>
<p>将上面分区所需要使用的命令总结如下，以后便于使用脚本分区。  </p>
<p>s   fdisk /dev/sdb  # 选择要分区的设备<br>n  # 创建分区<br>p/e/l # 选择分区类型    </p>
<p>如果主分区数有3个，且已经划分了扩展分区，再继续分区时将只能划分逻辑分区，这种情况下l选项会直接跳过进入下一个阶段。  </p>
<p>s   N  # 指定分区号<br>\n  # 指定起始柱面号，使用默认值就直接回车即换行<br>+N  # 指定分区大小为N<br>w   # 分区结束保存退出<br>partprobe /dev/sdb &amp;&gt;/dev/null #   重读分区表<br>fdisk -l | grep “^/dev/sdb”  &amp;&gt;/dev/null # 检查分区状态  </p>
<h4 id="使用gdisk分区工具"><a href="#使用gdisk分区工具" class="headerlink" title="使用gdisk分区工具"></a>使用gdisk分区工具</h4><p>gdisk用来划分gpt分区，需要单独安装这个工具包。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; yum -y install gdisk</span><br></pre></td></tr></table></figure>
<p>分区的时候直接带上设备即可。以下是对新硬盘划分gpt分区的过程。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# gdisk /dev/sdb</span><br><span class="line">GPT fdisk (gdisk) version 0.8.10</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: not present</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: not present</span><br><span class="line"></span><br><span class="line">Creating new GPT entries.</span><br><span class="line"></span><br><span class="line">Command (? for help): ?</span><br><span class="line">b       back up GPT data to a file</span><br><span class="line">c       change a partition&apos;s name</span><br><span class="line">d       delete a partition                               # 删除分区</span><br><span class="line">i       show detailed information on a partition         # 列出分区详细信息</span><br><span class="line">l       list known partition types                       # 列出所以已知的分区类型</span><br><span class="line">n       add a new partition                              # 添加新分区</span><br><span class="line">o       create a new empty GUID partition table (GPT)    # 创建一个新的空的guid分区表</span><br><span class="line">p       print the partition table                        # 输出分区表信息</span><br><span class="line">q       quit without saving changes                      # 退出gdisk工具</span><br><span class="line">r       recovery and transformation options (experts only) </span><br><span class="line">s       sort partitions                                </span><br><span class="line">t       change a partition&apos;s type code                   # 修改分区类型</span><br><span class="line">v       verify disk</span><br><span class="line">w       write table to disk and exit                     # 将分区信息写入到磁盘</span><br><span class="line">x       extra functionality (experts only)             </span><br><span class="line">?       print this menu</span><br></pre></td></tr></table></figure>
<p>添加一个新分区。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Command (? for help): n   </span><br><span class="line">Partition number (1-128, default 1):</span><br><span class="line">First sector (34-41943006, default = 2048) or &#123;+-&#125;size&#123;KMGTP&#125;:</span><br><span class="line">Last sector (2048-41943006, default = 41943006) or &#123;+-&#125;size&#123;KMGTP&#125;: +10G</span><br><span class="line">Current type is &apos;Linux filesystem&apos;</span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300):</span><br><span class="line">Changed type of partition to &apos;Linux filesystem&apos;</span><br><span class="line"> </span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk /dev/sdb: 41943040 sectors, 20.0 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): F8AE925F-515F-4807-92ED-4109D0827191</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 41943006</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 20971453 sectors (10.0 GiB)</span><br><span class="line"> </span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048        20973567   10.0 GiB    8300  Linux filesystem</span><br><span class="line"></span><br><span class="line">Command (? for help): i   # 查看分区详细信息</span><br><span class="line">Using 1</span><br><span class="line">Partition GUID code: 0FC63DAF-8483-4772-8E79-3D69D8477DE4 (Linux filesystem)</span><br><span class="line">Partition unique GUID: B2452103-4F32-4B60-AEF7-4BA42B7BF089</span><br><span class="line">First sector: 2048 (at 1024.0 KiB)</span><br><span class="line">Last sector: 20973567 (at 10.0 GiB)</span><br><span class="line">Partition size: 20971520 sectors (10.0 GiB)</span><br><span class="line">Attribute flags: 0000000000000000</span><br><span class="line">Partition name: &apos;Linux filesystem</span><br></pre></td></tr></table></figure>
<p>‘<br>保存分区表到磁盘。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Command (? for help): w </span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): Y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sdb.</span><br><span class="line">The operation has completed successfully.</span><br></pre></td></tr></table></figure>
<p>执行partprobe重新读取分区表信息。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# partprobe  /dev/sdb</span><br></pre></td></tr></table></figure>
<p>gdisk还有几个expert only的命令，其实没什么专家不专家可用的，咱们需要知道的是命令何时能用，它们的作用是什么？  </p>
<p>在gdisk交互过程命令行下，按下x表示进入扩展功能模式，该模式下的功能大部分都和gpt分区表相关，在不是非常了解gpt分区表结构的时候不建议做修改动作，但是查看信息类是没问题的。以下是扩展功能模式下的命令。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Command (? for help): x</span><br><span class="line"></span><br><span class="line">Expert command (? for help): ?</span><br><span class="line">a       set attributes</span><br><span class="line">c       change partition GUID</span><br><span class="line">d       display the sector alignment value</span><br><span class="line">e       relocate backup data structures to the end of the disk</span><br><span class="line">g       change disk GUID</span><br><span class="line">h       recompute CHS values in protective/hybrid MBR</span><br><span class="line">i       show detailed information on a partition</span><br><span class="line">l       set the sector alignment value</span><br><span class="line">m       return to main menu</span><br><span class="line">n       create a new protective MBR</span><br><span class="line">o       print protective MBR data</span><br><span class="line">p       print the partition table</span><br><span class="line">q       quit without saving changes</span><br><span class="line">r       recovery and transformation options (experts only)</span><br><span class="line">s       resize partition table    # 修改分区表大小，注意不是分区大小</span><br><span class="line">t       transpose two partition table entries</span><br><span class="line">u       Replicate partition table on new device  # 将分区表导出</span><br><span class="line">v       verify disk</span><br><span class="line">w       write table to disk and exit</span><br><span class="line">z       zap (destroy) GPT data structures and exit     # 损毁gpt上的数据</span><br><span class="line">?       print this menu</span><br></pre></td></tr></table></figure>
<h4 id="使用parted分区工具"><a href="#使用parted分区工具" class="headerlink" title="使用parted分区工具"></a>使用parted分区工具</h4><p>parted支持mbr格式和gpt格式的磁盘分区。它的强大在于可以一步到位而不需要不断的交互式输入(也可以交互式)。  </p>
<p>parted分区工具是实时的，所以每一步操作都是直接写入磁盘而不是写进内存，它不像fdisk/gdisk还需要w命令将内存中的结果保存到磁盘中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# parted /dev/sdc</span><br><span class="line">GNU Parted 2.1</span><br><span class="line">Using /dev/sdc</span><br><span class="line">Welcome to GNU Parted! Type &apos;help&apos; to view a list of commands.</span><br><span class="line"> </span><br><span class="line">(parted) help                                                             </span><br><span class="line">  align-check TYPE N                      check partition N for TYPE(min|opt) alignment</span><br><span class="line">  check NUMBER                            do a simple check on the file system(centos 7上已删除该功能)</span><br><span class="line">  cp [FROM-DEVICE] FROM-NUMBER TO-NUMBER  copy file system to another partition(centos 7上已删除该功能)</span><br><span class="line">  help [COMMAND]                          print general help, or help on COMMAND</span><br><span class="line">  mklabel,mktable LABEL-TYPE              create a new disklabel (partition table)</span><br><span class="line">  mkfs NUMBER FS-TYPE                     make a FS-TYPE file system on partition NUMBER (centos 7上已删除改该功能) </span><br><span class="line">  mkpart PART-TYPE [FS-TYPE] START END    make a partition</span><br><span class="line">  mkpartfs PART-TYPE FS-TYPE START END    make a partition with a file system(centos 7上已删除该功能)   </span><br><span class="line">  move NUMBER START END                   move partition NUMBER(centos 7上已删除该功能) </span><br><span class="line">  name NUMBER NAME                        name partition NUMBER as NAME</span><br><span class="line">  print [devices|free|list,all|NUMBER]    display the partition table,available devices,free space, all found partitions,or a particular partition</span><br><span class="line">  quit                                    exit program</span><br><span class="line">  rescue START END                        rescue a lost partition near START and END</span><br><span class="line">  resize NUMBER START END                 resize partition NUMBER and its file system(修改分区大小(centos 7上已删除该功能))</span><br><span class="line">  rm NUMBER                               delete partition NUMBER (删除分区)             </span><br><span class="line">  select DEVICE                           choose the device to edit (重选磁盘进入parted状态)  </span><br><span class="line">  set NUMBER FLAG STATE                   change the FLAG on partition NUMBER(设置分区状态，如将其off或on)  </span><br><span class="line">  toggle [NUMBER [FLAG]]                  toggle the state of FLAG on partition NUMBER(修改文件系统类型，如swap、lvm)  </span><br><span class="line">  unit UNIT                               set the default unit to UNIT(修改默认单位，kB/MB/GB等)</span><br><span class="line">  version                                 display the version number and copyright information of GNU Parted</span><br></pre></td></tr></table></figure>
<p>常用的命令是mklabel/rm/print/mkpart/help/quit，至于parted中一些看上去很好的功能如mkfs/mkpartfs/resize等可能会损毁当前数据而不够安全，所以只要使用它的5个常用命令即可。  </p>
<p>parted分区的前提是磁盘已经有分区表(partition table)或磁盘标签(disk label)，否则将显示”unrecognised disk label”，这是和fdisk/gdisk不同的地方，所以需要先使用mklabel创建标签或分区表，最常见的标签(分区表)为”msdos”和”gpt”，其中msdos分区就是MBR格式的分区表，也就是会有主分区、扩展分区和逻辑分区的概念和限制。  </p>
<p>下面使用parted对/dev/sdc创建msdos的新分区。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# parted /dev/sdc</span><br><span class="line">GNU Parted 2.1</span><br><span class="line">Using /dev/sdb</span><br><span class="line">Welcome to GNU Parted! Type &apos;help&apos; to view a list of commands.</span><br><span class="line">(parted) mklabel             # 创建磁盘分区标签(分区表类型)                                               </span><br><span class="line">New disk label type? msdos   # 选择msdos即MBR类型    </span><br><span class="line">                             # 上面的两步也可以直接一步进行：(parted) mklabel msdos      </span><br><span class="line">(parted) mkpart              # 开始进行分区     </span><br><span class="line">Partition type?  primary/extended? p     # 创建主分区</span><br><span class="line">File system type?  [ext2]? ext4          # 创建ext4文件系统</span><br><span class="line">                                         # (注意，这里虽然指明了文件系统，但没有任何意义，后面还是需要手动格式化并选择文件系统类型)</span><br><span class="line">Start? 1                                 # 分区开始位置，默认是M为单位，表示从1M开始，也可直接指定1G这种方式</span><br><span class="line">End? 1024                                # 分区结束位置，1024-1=1023M</span><br><span class="line"></span><br><span class="line">(parted) p                   # print，查看分区信息</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line"> 1      1049kB  1024MB  1023MB  primary</span><br><span class="line"></span><br><span class="line"># 可以一步完成一个命令中的多个动作</span><br><span class="line">(parted) mkpart p ext4 1026M 4096M       # 可以一步完成，也可以一步完成到任何位置，然后继续交互下一步</span><br><span class="line">                                         # 可能会提示分区未对齐&quot;Warning: The resulting partition is not properly aligned for best performance.&quot;，忽略它</span><br><span class="line">(parted) mkpart e 4098 -1    # 创建扩展分区，注意创建扩展分区时不指定文件系统类型；-1表示剩余的全部分配给该分区</span><br><span class="line"></span><br><span class="line">(parted) p                                                               </span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1024MB  1023MB  primary</span><br><span class="line"> 2      1026MB  4096MB  3070MB  primary</span><br><span class="line"> 3      4098MB  21.5GB  17.4GB  extended               lba</span><br><span class="line"></span><br><span class="line">(parted) mkpart l ext4 4099 8194     # 创建逻辑分区，指定ext4</span><br><span class="line">(parted) mkpart l ext4 8195 -1       # 继续创建逻辑分区</span><br><span class="line">(parted) p</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1024MB  1023MB  primary</span><br><span class="line"> 2      1026MB  4096MB  3070MB  primary</span><br><span class="line"> 3      4098MB  21.5GB  17.4GB  extended               lba</span><br><span class="line"> 5      4099MB  8194MB  4095MB  logical</span><br><span class="line"> 6      8195MB  21.5GB  13.3GB  logical</span><br><span class="line"></span><br><span class="line">(parted) rm 5    # 删除5号分区</span><br><span class="line">(parted) p</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type      File system  Flags</span><br><span class="line"> 1      1049kB  1024MB  1023MB  primary</span><br><span class="line"> 2      1026MB  4096MB  3070MB  primary</span><br><span class="line"> 3      4098MB  21.5GB  17.4GB  extended               lba</span><br><span class="line"> 5      8195MB  21.5GB  13.3GB  logical</span><br><span class="line"></span><br><span class="line">(parted) quit                                    # 退出parted工具</span><br><span class="line">Information: You may need to update /etc/fstab.  # 提示你要更新/etc/fstab中的配置，说明该工具是可以在线分区的</span><br></pre></td></tr></table></figure>
<p>mkfs和mkpartfs等命令不完善，下面的警告信息已经给出了提示。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(parted) mkfs 1                                                          </span><br><span class="line"></span><br><span class="line">WARNING: you are attempting to use parted to operate on (mkfs) a file system.</span><br><span class="line">parted&apos;s file system manipulation code is not as robust as what you&apos;ll find in</span><br><span class="line">dedicated, file-system-specific packages like e2fsprogs.  We recommend</span><br><span class="line">you use parted only to manipulate partition tables, whenever possible.</span><br><span class="line">Support for performing most operations on most types of file systems</span><br><span class="line">will be removed in an upcoming release.</span><br><span class="line">Warning: The existing file system will be destroyed and all data on the partition will be lost. Do you want to</span><br><span class="line">continue?</span><br><span class="line">parted: invalid token: 1</span><br><span class="line">Yes/No? n</span><br></pre></td></tr></table></figure>
<p>使用parted工具进行的分区无需运行partprobe重新读取分区表，内核会即时识别已经分区的分区信息。如下所示。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi tmp]# cat /proc/partitions  | grep &quot;sdc&quot;</span><br><span class="line">   8       32   20971520 sdc</span><br><span class="line">   8       33     999424 sdc1</span><br><span class="line">   8       34    2998272 sdc2</span><br><span class="line">   8       35         1  sdc3</span><br><span class="line">   8       37   12967936 sdc5</span><br></pre></td></tr></table></figure>
<p>一定要注意，虽然parted工具中指定了文件系统，但是并没有意义，它仍需要手动进行格式化并指定分区类型。实际上，在parted中文件系统是可以不用指定的，即使是非交互模式下也可以省略。  </p>
<h4 id="fdisk-gdisk以及parted非交互式操作分区"><a href="#fdisk-gdisk以及parted非交互式操作分区" class="headerlink" title="fdisk/gdisk以及parted非交互式操作分区"></a>fdisk/gdisk以及parted非交互式操作分区</h4><p>使用非交互分区时，最重要的是待分的区的起始点不能是已使用的。可以使用lsblk或fdisk -l或parted DEV print来判断将要从哪个地方开始分区。其实parted在非交互分区是最佳的工具，不仅是因为其书写方式简洁，而且待分区的起点如不合理它会自动提示是否要自动调整。  </p>
<h5 id="parted实现非交互"><a href="#parted实现非交互" class="headerlink" title="parted实现非交互"></a>parted实现非交互</h5><p>parted命令只能一次非交互一个命令中的所有动作。如下所示：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/sdb mklabel msdos                 # 设置硬盘flag</span><br><span class="line">parted /dev/sdb mkpart primary ext4 1 1000    # Mbr格式分区，分别是partition type/fstype/start/end</span><br><span class="line">parted /dev/sdb mkpart 1 ext4 1M 10240M       # gpt格式分区，分别是name/fstype/start/end</span><br><span class="line">parted /dev/sdb mkpart 1 10G 15G              # 省略fstype的交互式分区</span><br><span class="line">parted /dev/sdb rm 1                          # 删除分区</span><br><span class="line">parted /dev/sdb p                             # 输出信息</span><br></pre></td></tr></table></figure>
<p>如果不确定分区的起点大小，可以加上-s选项使用script模式，该模式下parted将回答一切默认值，如yes、no。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; parted -s /dev/sdb mkpart 3 14G 16G</span><br><span class="line">Warning: You requested a partition from 14.0GB to 16.0GB.                </span><br><span class="line">The closest location we can manage is 15.0GB to 16.0GB.</span><br><span class="line">Is this still acceptable to you?</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br></pre></td></tr></table></figure>
<h5 id="fdisk实现非交互"><a href="#fdisk实现非交互" class="headerlink" title="fdisk实现非交互"></a>fdisk实现非交互</h5><p>fdisk实现非交互的原理是从标准输入中读取，每读取一行传递一次操作。  </p>
<p>所以可以有两种方式：使用echo和管道传递；将操作写入到文件中，从文件中读取。  </p>
<p>例如：下面的命令创建了两个分区。使用默认值时传递空行即可。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;n\np\n1\n\n+5G\nn\np\n2\n\n+1G\nw\n&quot;  | fdisk /dev/sdb</span><br></pre></td></tr></table></figure>
<p>如果要传递的操作很多，则可以将它们写入到一个文件中，从文件中读取。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;n\np\n1\n\n+5G\nn\np\n2\n\n+1G\nw\n&quot; &gt;/tmp/a.txt</span><br><span class="line">fdisk /dev/sdb &lt;/tmp/a.txt</span><br></pre></td></tr></table></figure>
<h5 id="gdisk实现非交互"><a href="#gdisk实现非交互" class="headerlink" title="gdisk实现非交互"></a>gdisk实现非交互</h5><p>原理同fdisk。例如：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;n\n1\n\n+3G\n\nw\nY\n&quot; | gdisk /dev/sdb</span><br></pre></td></tr></table></figure>
<p>上面传递的各参数意义为：新建分区，分区number为1，使用默认开始扇区位置，分区大小+3G，使用默认分区类型，保存，确认。  </p>
<h4 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h4><p>分区结束后就需要格式化创建文件系统了，格式化分区的过程就是创建文件系统的过程。可以使用mkfs(make filesystem)工具进行格式化，也可以使用该工具家族的其他工具如mkfs.ext4/mkfs.xfs等专门针对文件系统的工具。  </p>
<p>要查看支持的文件系统类型，只需简单的输入mkfs然后按两下tab键，就可以列出各文件系统对应的格式化命令，这些就是支持的文件系统类型。  </p>
<p>CentOS 6上支持的：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mkfs</span><br><span class="line">mkfs      mkfs.cramfs   mkfs.ext2     mkfs.ext3     mkfs.ext4     mkfs.ext4dev  mkfs.msdos    mkfs.vfat</span><br></pre></td></tr></table></figure>
<p>CentOS 7上支持的：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# mkfs</span><br><span class="line">mkfs      mkfs.btrfs   mkfs.cramfs  mkfs.ext2    mkfs.ext3    mkfs.ext4    mkfs.fat     mkfs.minix   mkfs.msdos   mkfs.vfat    mkfs.xfs</span><br></pre></td></tr></table></figure>
<p>5.4.1 mkfs工具</p>
<p>mkfs [-t fstype] 分区<br>该工具非常简单，它只需指定一个可选的”-t”选项指定要创建的文件系统类型，如果省略则默认创建ext2文件系统。该工具指定的”-t”选项其实是在调用对应文件系统专属的格式化工具。  </p>
<h4 id="mke2fs工具"><a href="#mke2fs工具" class="headerlink" title="mke2fs工具"></a>mke2fs工具</h4><p>mkfs.ext2/mkfs.ext3/mkfs.ext4或mkfs -t extX其实都是在调用mke2fs工具。  </p>
<p>该工具创建文件系统时，会从/etc/mke2fs.conf配置中读取默认的配置项。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mke2fs [ -c ] [ -b block-size ] [ -f fragment-size ] [ -g blocks-per-group ] [ -G number-of-groups ] </span><br><span class="line">       [ -i bytes-per-inode ] [ -I inode-size ] [ -j ] [ -N number-of-inodes ] [ -m reserved-blocks-percentage ] </span><br><span class="line">       [ -q ] [ -r fs-revision-level ] [ -v ] [ -L volume-label ] [ -S ] [ -t fs-type ] device [ blocks-count ]</span><br><span class="line"></span><br><span class="line">选项说明：</span><br><span class="line">-t fs-type         ：指定要创建的文件系统类型(ext2,ext3 ext4)，若不指定，则从/etc/mke2fs.conf中获取默认的文件系统类型。</span><br><span class="line">-b block-size      ：指定每个block的大小，有效值有1024、2048和4096，单位是字节。</span><br><span class="line">-I inode-size      ：指定inode大小，单位为字节。必须为2的幂次方，且大于等于128字节。值越大，说明inode的集合体inode table占用越多的空</span><br><span class="line">                     间，这不仅会挤占文件系统中的可用空间，还会降低性能，因为要扫描inode table需要消耗更多时间，但是在linux kernel 2.6.10</span><br><span class="line">                     之后，由于使用inode存储了很多扩展的额外属性，所以128字节已经不够用了，因此ext4默认的inode size已经变为256，尽管</span><br><span class="line">                     inode大小增大了，但因为使用inode存储扩展属性带来的性能提升远高于inode size变大导致的负面影响，所以仍建议使用256字</span><br><span class="line">                     节的inode。</span><br><span class="line">-i bytes-per-inode ：指定每多少个字节就为其分配一个inode号。值越大，说明一个文件系统中分配的inode号越少，更适用于存储大量大文件，值越</span><br><span class="line">                     小，inode号越多，更适用于存储大量小文件。该值不能小于一个block的大小，因为这样会造成inode多余。</span><br><span class="line">                     注意，创建文件系统后该值就不能再改变了。</span><br><span class="line">-c                 ：创建文件系统前先检查设备是否有bad blocks。</span><br><span class="line">-f fragment-size   ：指定fragments的大小，单位字节。</span><br><span class="line">-g blocks-per-group：指定每个块组中的block数量。不建议修改此项。</span><br><span class="line">-G number-of-groups：该选项用于ext4文件系统(严格地说是启用了flex_bg特性)，指定虚拟块组(即一个extent)中包含的块组个数，必须为2的幂次方。</span><br><span class="line">                     对于ext4文件系统来说，使用extent的功能能极大提升其性能。</span><br><span class="line">-j                 ：创建带有日志功能的文件系统，即ext3。如果要指定关于日志方面的设置，在-j的基础上再使用-J指定，不过一般默认即可，具体可</span><br><span class="line">                     指定的选项看man文档。 </span><br><span class="line">-L new-volume-label：指定卷标名称，名称不得超出16字节。</span><br><span class="line">-m reserved-blocks-percentage：指定文件系统保留block数量的比例，保留一部分block，可以降低物理碎片。默认比例为5%。</span><br><span class="line">-N number-of-inodes ：强制指定该文件系统应该分配多少个inode号，它会覆盖通过计算得出inode数量的结果(根据block大小、数量和每多少字节分配</span><br><span class="line">                      一个inode得出Inode数量)，但是不建议这么做。</span><br><span class="line">-q                  ：安静模式，可用于脚本中</span><br><span class="line">-S                  ：重建superblock和group descriptions。在所有的superblock和备份的superblock都损坏时有用。它会重新初始化superblock和</span><br><span class="line">                      group descriptions，但不会改变inode table、bmap和imap(若真的改变，该分区数据就全丢了，还不如重新格式化)。在重建</span><br><span class="line">                      superblock后，应该执行e2fsck来保证文件系统的一致性。但要注意，应该完全正确地指定block的大小，其改选项并不能完全保</span><br><span class="line">                      证数据不丢失。</span><br><span class="line">-v                  ：输出详细执行过程</span><br></pre></td></tr></table></figure>
<p>所以，有可能用到的选项也就”-t”指定文件系统类型，”-b”指定block大小，”-I”指定inode大小，”-i”指定分配inode的比例。  </p>
<p>例如：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mke2fs -t ext4 -I 256 /dev/sdb2 -b 4096</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">655360 inodes, 2621440 blocks</span><br><span class="line">131072 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2684354560</span><br><span class="line">80 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><br><span class="line"></span><br><span class="line">Writing inode tables: done                           </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 39 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure>
<p>提示使用tune2fs修改自动检测文件系统的频率。见下文。  </p>
<h5 id="tune2fs修改ext文件系统属性"><a href="#tune2fs修改ext文件系统属性" class="headerlink" title="tune2fs修改ext文件系统属性"></a>tune2fs修改ext文件系统属性</h5><p>该工具其实没什么太大作用，文件系统创建好后很多属性是固定不能修改的，能修改的属性很有限，且都是无关紧要的。  </p>
<p>但有些时候还是可以用到它做些事情，例如刚创建完ext文件系统后会提示修改自检时间。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tune2fs [  -c  max-mount-counts ] [ -i interval-between-checks ] [ -j ] device</span><br><span class="line">-j：将ext2文件系统升级为ext3；</span><br><span class="line">-c：修改文件系统最多挂载多少次后进行自检，设置为0或-1将永不自检；</span><br><span class="line">-i：修改过了多少时间进行自检。时间单位可以指定为天(默认)/月/星期[d|m|w]，设置为0将永不自检。</span><br></pre></td></tr></table></figure>
<p>例如：tune2fs -i 0 /dev/sdb1<br>5.5 查看文件系统状态信息</p>
<h4 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h4><p>lsblk(list block devices)用于列出设备及其状态，主要列出非空的存储设备。其实它只会列出/sys/dev/block中的主次设备号文件，且默认只列出非空设备。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# lsblk</span><br></pre></td></tr></table></figure>
<p>其中上面的几列意义如下：  </p>
<p>NAME：设备名称；<br>MAJ:MIN：主设备号和此设备号；<br>RM：是否为可卸载设备，1表示可卸载设备。可卸载设备如光盘、USB等。并非能够umount的就是可卸载的；<br>SIZE：设备总空间大小；<br>RO：是否为只读；<br>TYPE：是磁盘disk，还是分区part，亦或是rom，还有loop设备；<br>mountpoint：挂载点。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# lsblk /dev/sdb</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb      8:16   0   20G  0 disk</span><br><span class="line">├─sdb1   8:17   0  9.5G  0 part /mydata/data</span><br><span class="line">└─sdb2   8:18   0    3G  0 part</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# lsblk /dev/sdb1</span><br><span class="line">NAME MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb1   8:17   0  9.5G  0 part /mydata/data</span><br></pre></td></tr></table></figure>
<p>另外常用的一个选项是”-f”，它可以查看到文件系统类型，和文件系统的uuid和挂载点。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# lsblk -f</span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sda                                                     </span><br><span class="line">├─sda1 ext4         77b5f0da-b0f9-4054-9902-c6cdacf29f5e /boot</span><br><span class="line">├─sda2 ext4         f199fcb4-fb06-4bf5-a1b7-a15af0f7cb47 /</span><br><span class="line">└─sda3 swap         6ae3975c-1a2a-46e3-87f3-d5bd3f1eff48 [SWAP]</span><br><span class="line">sr0                                                     </span><br><span class="line">sdb                                                      </span><br><span class="line">├─sdb1 ext4         95e5b9d5-be78-43ed-a06a-97fd1de9a3fe</span><br><span class="line">├─sdb2 ext2         45da2d94-190a-4548-85bb-b3c46ae6d9a7</span><br><span class="line">└─sdb3</span><br></pre></td></tr></table></figure>
<p>每个已经格式化的文件系统都有其类型和uuid，而没有格式化的设备(如/dev/sdb3)，将只显示一个Name结果，表示该设备还未进行格式化。  </p>
<h4 id="blkid"><a href="#blkid" class="headerlink" title="blkid"></a>blkid</h4><p>虽然它有不少比较强大的功能，但一般只用它一个功能，就是查看器文件系统类型和uuid。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;77b5f0da-b0f9-4054-9902-c6cdacf29f5e&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/sda2: UUID=&quot;f199fcb4-fb06-4bf5-a1b7-a15af0f7cb47&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/sda3: UUID=&quot;6ae3975c-1a2a-46e3-87f3-d5bd3f1eff48&quot; TYPE=&quot;swap&quot;</span><br><span class="line">/dev/sdb1: UUID=&quot;95e5b9d5-be78-43ed-a06a-97fd1de9a3fe&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/sdb2: UUID=&quot;45da2d94-190a-4548-85bb-b3c46ae6d9a7&quot; TYPE=&quot;ext2&quot;</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# blkid /dev/sdb1</span><br><span class="line">/dev/sdb1: UUID=&quot;95e5b9d5-be78-43ed-a06a-97fd1de9a3fe&quot; TYPE=&quot;ext4&quot;</span><br></pre></td></tr></table></figure>
<h4 id="parted-dev-sda-print和fdisk-l"><a href="#parted-dev-sda-print和fdisk-l" class="headerlink" title="parted /dev/sda print和fdisk -l"></a>parted /dev/sda print和fdisk -l</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; parted /dev/sdb p</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name              Flags</span><br><span class="line"> 1      1049kB  10.2GB  10.2GB  ext4</span><br><span class="line"> 2      10.2GB  13.5GB  3221MB  ext2         Linux filesystem</span><br><span class="line"></span><br><span class="line">shell&gt; fdisk -l /dev/sda</span><br><span class="line">Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x000cb657</span><br><span class="line"> </span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048      514047      256000   83  Linux</span><br><span class="line">/dev/sda2          514048    37847039    18666496   83  Linux</span><br><span class="line">/dev/sda3        37847040    41943039     2048000   82  Linux swap / Solaris</span><br></pre></td></tr></table></figure>
<p>虽然fdisk和gdisk分别是mbr和gpt格式的专用工具，但是仅用于查看信息还是可以的。parted能兼容两者，所以也可以。  </p>
<h4 id="file-s"><a href="#file-s" class="headerlink" title="file -s"></a>file -s</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# file -s /dev/sdb2</span><br><span class="line">/dev/sdb2: Linux rev 1.0 ext2 filesystem data (large files)</span><br></pre></td></tr></table></figure>
<h4 id="du"><a href="#du" class="headerlink" title="du"></a>du</h4><p>du命令用于评估文件的空间占用情况，它会统计每个文件的大小，统计时会递归统计目录中的文件，也就是说，它会遍历整个待统计目录，所以统计速度上可能并不理想。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">du [OPTION]... [FILE]...</span><br><span class="line">选项说明：</span><br><span class="line">-a, --all：列出目录中所有文件的统计信息，默认只会列出目录中子目录的统计信息，而不列出文件的统计信息</span><br><span class="line">-h, --human-readable：人性化显示大小</span><br><span class="line">-0, --null：以空字符结尾，即&quot;\0&quot;而非换行的&quot;\n&quot;</span><br><span class="line">-S, --separate-dirs：不包含子目录的大小</span><br><span class="line">-s, --summarize：对目录做总的统计，不列出目录内文件的大小信息</span><br><span class="line">-c,--total：对给出的文件或目录做总计。在统计非同一个目录文件大小时非常有用。见下文例子。</span><br><span class="line">--max-depth=N：只列出给定层次的目录统计，如果N=0，则等价于&quot;-s&quot;</span><br><span class="line">-x, --one-file-system：忽略不同文件系统上的文件，不对它们进行统计</span><br><span class="line">-X, --exclude-from=FILE：从文件中读取要排除的文件</span><br><span class="line">--exclude=PATTERN：指定要忽略不统计的文件</span><br></pre></td></tr></table></figure>
<p>注意:  </p>
<p>(1).上面的选项中，有些是不列出某些项，有些是不统计某些项，它们是不一样的。  </p>
<p>(2).如果要统计的目录下挂载了一个文件系统，那么这个文件系统的大小也会被计入该目录的大小中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# du -sh /etc</span><br><span class="line">29M     /etc</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# du -ah /tmp</span><br><span class="line">4.0K    /tmp/b.txt</span><br><span class="line">4.0K    /tmp/a</span><br><span class="line">4.0K    /tmp/.ICE-unix</span><br><span class="line">4.0K    /tmp/testdir/subdir</span><br><span class="line">0       /tmp/testdir/a.log</span><br><span class="line">8.0K    /tmp/testdir</span><br><span class="line">24K     /tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# du -h --max-depth=1 /usr</span><br><span class="line">15M     /usr/include</span><br><span class="line">383M    /usr/lib64</span><br><span class="line">132K    /usr/local</span><br><span class="line">391M    /usr/share</span><br><span class="line">4.0K    /usr/etc</span><br><span class="line">118M    /usr/lib</span><br><span class="line">44M     /usr/libexec</span><br><span class="line">49M     /usr/src</span><br><span class="line">32M     /usr/sbin</span><br><span class="line">4.0K    /usr/games</span><br><span class="line">75M     /usr/bin</span><br><span class="line">1.1G    /usr</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# du -h --max-depth=1 --exclude=/usr/lib64 /usr</span><br><span class="line">15M     /usr/include</span><br><span class="line">132K    /usr/local</span><br><span class="line">391M    /usr/share</span><br><span class="line">4.0K    /usr/etc</span><br><span class="line">118M    /usr/lib</span><br><span class="line">44M     /usr/libexec</span><br><span class="line">49M     /usr/src</span><br><span class="line">32M     /usr/sbin</span><br><span class="line">4.0K    /usr/games</span><br><span class="line">75M     /usr/bin</span><br><span class="line">721M    /usr</span><br></pre></td></tr></table></figure>
<p>搜索符合条件的文件，然后统计它们的总大小。结合find使用，效果极佳。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# find /boot/ -type f -name &quot;*.img&quot; -print0 | xargs -0 du -ch</span><br><span class="line">28K     /boot/grub2/i386-pc/core.img</span><br><span class="line">4.0K    /boot/grub2/i386-pc/boot.img</span><br><span class="line">592K    /boot/initrd-plymouth.img</span><br><span class="line">44M     /boot/initramfs-0-rescue-d13bce5e247540a5b5886f2bf8aabb35.img</span><br><span class="line">17M     /boot/initramfs-3.10.0-327.el7.x86_64.img</span><br><span class="line">16M     /boot/initramfs-3.10.0-327.el7.x86_64kdump.img</span><br><span class="line">76M     total</span><br></pre></td></tr></table></figure>
<p>请注意”-c”和”-s”统计的区别。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# find /boot/ -type f -name &quot;*.img&quot; -print0 | xargs -0 du -sh</span><br><span class="line">28K     /boot/grub2/i386-pc/core.img</span><br><span class="line">4.0K    /boot/grub2/i386-pc/boot.img</span><br><span class="line">592K    /boot/initrd-plymouth.img</span><br><span class="line">44M     /boot/initramfs-0-rescue-d13bce5e247540a5b5886f2bf8aabb35.img</span><br><span class="line">17M     /boot/initramfs-3.10.0-327.el7.x86_64.img</span><br><span class="line">16M     /boot/initramfs-3.10.0-327.el7.x86_64kdump.img</span><br></pre></td></tr></table></figure>
<h4 id="df"><a href="#df" class="headerlink" title="df"></a>df</h4><p>df用于报告磁盘空间使用率，默认显示的大小是1K大小block数量，也就是以k为单位。  </p>
<p>和du不同的是，df是读取每个文件系统的superblock信息，所以评估速度非常快。由于是读取superblock，所以如果目录下挂载了另一个文件系统，是不会将此挂载的文件系统计入目录大小的。注意，du和df统计的结果是不一样的，如果对它们的结果不同有兴趣，可参考我的另一篇文章：详细分析du和df的统计结果为什么不一样。   </p>
<p>如果用df统计某个文件的空间使用情况，将会转而统计该文件所在文件系统的空间使用情况。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df [OPTION]... [FILE]...</span><br><span class="line">选项说明：</span><br><span class="line">-h：人性化转换大小的显示单位</span><br><span class="line">-i：统计inode使用情况而非空间使用情况</span><br><span class="line">-l, --local：只列出本地文件系统的使用情况，不列出网络文件系统信息</span><br><span class="line">-T, --print-type：同时输出文件系统类型</span><br><span class="line">-t, --type=TYPE：只列出给定文件系统的统计信息</span><br><span class="line">-x, --exclude-type=TYPE：指定不显示的文件系统类型的统计信息</span><br></pre></td></tr></table></figure>
<p>示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# df -hT</span><br><span class="line">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda2      xfs        18G  2.3G   16G  13% /</span><br><span class="line">devtmpfs       devtmpfs  904M     0  904M   0% /dev</span><br><span class="line">tmpfs          tmpfs     913M     0  913M   0% /dev/shm</span><br><span class="line">tmpfs          tmpfs     913M  8.6M  904M   1% /run</span><br><span class="line">tmpfs          tmpfs     913M     0  913M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1      xfs       247M  110M  137M  45% /boot</span><br><span class="line">tmpfs          tmpfs     183M     0  183M   0% /run/user/0</span><br><span class="line">/dev/sdb1      ext4      9.3G   37M  8.8G   1% /mydata/data</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# df -i</span><br><span class="line">Filesystem       Inodes  IUsed    IFree IUse% Mounted on</span><br><span class="line">/dev/sda2      18666496 106474 18560022    1% /</span><br><span class="line">devtmpfs         231218    388   230830    1% /dev</span><br><span class="line">tmpfs            233586      1   233585    1% /dev/shm</span><br><span class="line">tmpfs            233586    479   233107    1% /run</span><br><span class="line">tmpfs            233586     13   233573    1% /sys/fs/cgroup</span><br><span class="line">/dev/sda1        256000    330   255670    1% /boot</span><br><span class="line">tmpfs            233586      1   233585    1% /run/user/0</span><br><span class="line">/dev/sdb1        625856     14   625842    1% /mydata/data</span><br></pre></td></tr></table></figure>
<h4 id="dumpe2fs"><a href="#dumpe2fs" class="headerlink" title="dumpe2fs"></a>dumpe2fs</h4><p>用于查看ext类文件系统的superblock及块组信息。使用-h选项将只显示superblock信息。  </p>
<p>以下是ext4文件系统superblock的信息。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# dumpe2fs -h /dev/sda2</span><br><span class="line">dumpe2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          /</span><br><span class="line">Filesystem UUID:          f199fcb4-fb06-4bf5-a1b7-a15af0f7cb47</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision #:    1 (dynamic)</span><br><span class="line">Filesystem featurs:      has_journal ext_attr resize_inode dir_index filetype needs_recovery exent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize</span><br><span class="line">Filesystem flags:         signed_directory_hash</span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:          Continue</span><br><span class="line">Filesystem OS type:       Linux</span><br><span class="line">Inode count:              1166880</span><br><span class="line">Block count:              4666624</span><br><span class="line">Reserved block count:     233331</span><br><span class="line">Free blocks:              4196335</span><br><span class="line">Free inodes:              1111754</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Reserved GDT blocks:      1022</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         8160</span><br><span class="line">Inode blocks per group:   510</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Filesystem created:       Sat Feb 25 11:48:47 2017</span><br><span class="line">Last mount time:          Tue Jun  6 18:13:10 2017</span><br><span class="line">Last write time:          Sat Feb 25 11:53:49 2017</span><br><span class="line">Mount count:              6</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Sat Feb 25 11:48:47 2017</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          2657 MB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:               256</span><br><span class="line">Required extra isize:     28</span><br><span class="line">Desired extra isize:      28</span><br><span class="line">Journal inode:            8</span><br><span class="line">Default directory hash:   half_md4</span><br><span class="line">Directory Hash Seed:      d4e6493a-09ef-41a1-9d66-4020922f1aa9</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">Journal features:         journal_incompat_revoke</span><br><span class="line">Journal size:             128M</span><br><span class="line">Journal length:           32768</span><br><span class="line">Journal sequence:         0x00001bd9</span><br><span class="line">Journal start:            23358</span><br></pre></td></tr></table></figure>
<p>其中一个块组信息。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# dumpe2fs /dev/sda2 | tail -7</span><br><span class="line">dumpe2fs 1.41.12 (17-May-2010)</span><br><span class="line">Group 142: (Blocks 4653056-4666623) [INODE_UNINIT, ITABLE_ZEROED]</span><br><span class="line">  Checksum 0x64ce, unused inodes 8160</span><br><span class="line">  Block bitmap at 4194318 (+4294508558), Inode bitmap at 4194334 (+4294508574)</span><br><span class="line">  Inode table at 4201476-4201985 (+4294515716)</span><br><span class="line">  13568 free blocks, 8160 free inodes, 0 directories, 8160 unused inodes</span><br><span class="line">  Free blocks: 4653056-4666623</span><br><span class="line">  Free inodes: 1158721-1166880</span><br></pre></td></tr></table></figure>
<h3 id="挂载和卸载文件系统"><a href="#挂载和卸载文件系统" class="headerlink" title="挂载和卸载文件系统"></a>挂载和卸载文件系统</h3><p>在此，只简单介绍mount和umount的用法，至于实现挂载和卸载的机制和原理细节，参看挂载文件系统的细节。  </p>
<h4 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h4><p>mount用来显示挂载信息或者进行文件系统挂载，它的功能及其的强大(强大到离谱)，它不仅支持挂载非常多种文件系统，如ext/xfs/nfs/smbfs/cifs (win上的共享目录)等，还支持共享挂载点、继承挂载点(父子关系)、绑定挂载点、移动挂载点等等功能。在本文只介绍其最简单的挂载功能。  </p>
<p>不同的文件系统挂载选项是有所差别的，在挂载过程中如果出错，应该man mount并查看对应文件系统的挂载选项。  </p>
<p>mount并非只能挂载文件系统，也可以将目录挂载到另一个目录下，其实它实现的是目录”硬链接”，默认情况下，是无法对目录建立硬链接的，但是通过mount可以完成绑定，绑定后两个目录的inode号是完全相同的，但尽管建立的是目录的”硬链接”，但其实也仅是拿来当软链接用。  </p>
<p>以下是ext类文件系统的选项，可能有些选项是不支持其他文件系统的。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mount # 将显示当前已挂载信息</span><br><span class="line">mount [-t 欲挂载文件系统类型 ] [-o 特殊选项] 设备名 挂载目录</span><br><span class="line"></span><br><span class="line">选项说明：</span><br><span class="line">-a  将/etc/fstab文件里指定的挂载选项重新挂载一遍。</span><br><span class="line">-t  支持ext2/ext3/ext4/vfat/fat/iso9660(光盘默认格式)。 不用-t时默认会调用blkid来获取文件系统类型。</span><br><span class="line">-n  不把挂载记录写在/etc/mtab文件中，一般挂载会在/proc/mounts中记录下挂载信息，然后同步到/etc/mtab，指定-n表示不同步该挂载信息。</span><br><span class="line">-o  指定挂载特殊选项。下面是两个比较常用的：</span><br><span class="line">    loop  挂载镜像文件，如iso文件</span><br><span class="line">    ro  只读挂载</span><br><span class="line">    rw  读写挂载</span><br><span class="line">    auto  相当于mount -a</span><br><span class="line">    dev 如果挂载的文件系统中有设备访问入口则启用它，使其可以作为设备访问入口</span><br><span class="line">    default rw,suid,dev,exec,auto,nouser,async,and relatime</span><br><span class="line">    async   异步挂载，只写到内存</span><br><span class="line">    sync    同步挂载，通过挂载位置写入对方硬盘</span><br><span class="line">    atime   修改访问时间，每次访问都修改atime会导致性能降低，所以默认是noatime</span><br><span class="line">    noatime 不修改访问时间，高并发时使用这个选项可以减少磁盘IO</span><br><span class="line">    nodiratime  不修改文件夹访问时间，高并发时使用这个选项可以减少磁盘IO</span><br><span class="line">    exec/noexec  挂载后的文件系统里的可执行程序是否可执行，默认是可以执行exec， 优先级高于权限的限定</span><br><span class="line">    remount  重新挂载，此时可以不用指定挂载点。</span><br><span class="line">    suid/nosuid 对挂载的文件系统启用或禁用suid，对于外来设备最好禁用suid</span><br><span class="line">    _netdev 需要网络挂载时默认将停留在挂载界面直到加载网络了。使用_netdev可以忽略网络正常挂载。如NFS开机挂载。</span><br><span class="line">    user  允许普通用户进行挂载该目录，但只允许挂载者进行卸载该目录</span><br><span class="line">    users  允许所有用户挂载和卸载该目录</span><br><span class="line">    nouser  禁止普通用户挂载和卸载该目录，这是默认的，默认情况下一个目录不指定user/users时，将只有root能挂载</span><br></pre></td></tr></table></figure>
<p>一般user/users/nouser都用在/etc/fstab中，直接在命令行下使用这几个选项意义不是很大。  </p>
<p>例如：<br>(1).挂载CentOS的安装镜像到/mnt。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/cdrom /mnt</span><br></pre></td></tr></table></figure>
<p>其实/dev/cdrom是/dev/sr0的一个软链接，/dev/sr0是光驱设备，所以也可以用/dev/sr0进行挂载。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sr0 /mnt</span><br></pre></td></tr></table></figure>
<p>(2).重新挂载。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mount -t ext4 -o remount /dev/sdb1 /data1</span><br></pre></td></tr></table></figure>
<p>(3).重新挂载文件系统为可读写。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 -o rw remount /dev/sdb1 /data1</span><br></pre></td></tr></table></figure>
<p>(4).挂载windows的共享目录。<br>win上共享文件的文件系统是cifs类型，要在Linux上挂载，必须得有mount.cifs命令，如果没有则安装cifs-utils包。  </p>
<p>假设win上共享目录的unc路径为\192.168.100.8\test，共享给的用户名和密码分别为long3:123，要挂在linux上的/mydata目录上。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mount.cifs -o username=&quot;long3&quot;,password=&quot;123&quot; //192.168.100.8/test /mydata</span><br></pre></td></tr></table></figure>
<p>注意，如果是比较新版本的win10(2017年之后更新的版本)或较新版本的win server，直接mount.cifs会报错：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mount.cifs -o username=&quot;long3&quot;,password=&quot;123&quot; //192.168.100.8/test /mnt         </span><br><span class="line">mount error(112): Host is down</span><br><span class="line">Refer to the mount.cifs(8) manual page (e.g. man mount.cifs)</span><br></pre></td></tr></table></figure>
<p>这是因为2017年微软的一个补丁禁用了SMBv1协议，通过smbclient的报告可知：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# yum -y install samba-client</span><br><span class="line">[root@xuexi ~]# smbclient -L //192.168.100.8</span><br><span class="line">Enter root&apos;s password: </span><br><span class="line">protocol negotiation failed: NT_STATUS_CONNECTION_RESET</span><br></pre></td></tr></table></figure>
<p>因此，在mount的时候指定cifs(SMB)的版本号为2.0即可。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mount.cifs -o username=&quot;long3&quot;,password=&quot;123&quot;,vers=2.0 //192.168.100.8/test /mnt</span><br></pre></td></tr></table></figure>
<p>但是需要注意，在CentOS 4,5,6下的模块cifs.ko版本(较低)只能使用SMBv1协议，因此即使指定版本号也一样无效。只有在CentOS 7上才能使用SMBv2或SMBv3。  </p>
<p>(5).基于ssh挂载远程目录。<br>如何基于ssh像NFS一样挂载远程主机上的目录？可以通过sshfs工具，该工具在fuse-sshfs包中，这个包在epel源中提供。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install fuse-sshfs</span><br></pre></td></tr></table></figure>
<p>例如，挂载192.168.100.8上的根目录到本地的/mnt上。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs 192.168.100.8:/ /mnt</span><br></pre></td></tr></table></figure>
<p>卸载时直接umount即可。  </p>
<p>(6).挂载目录到另一个目录下。挂载目录时，挂载目录和挂载点的inode是相同的，它们两者的内容也是完全相同的。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount --bind /mydata /mnt</span><br></pre></td></tr></table></figure>
<p>(7).查看某个目录是否是挂载点，使用mountpoint命令。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mountpoint /mydata/</span><br><span class="line">/mydata/ is a mountpoint</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# echo $?           </span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# mountpoint /mnt</span><br><span class="line">/mnt is not a mountpoint</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# echo $?       </span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>挂载的参数信息存放在/proc/mounts(是/proc/self/mounts的软链接)中，在/proc/self/mountstats和/proc/mountinfo里则记录了更详细的挂载信息。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# cat /proc/mounts</span><br><span class="line">rootfs / rootfs rw 0 0</span><br><span class="line">proc /proc proc rw,relatime 0 0</span><br><span class="line">sysfs /sys sysfs rw,relatime 0 0</span><br><span class="line">devtmpfs /dev devtmpfs rw,relatime,size=491000k,nr_inodes=122750,mode=755 0 0</span><br><span class="line">devpts /dev/pts devpts rw,relatime,gid=5,mode=620,ptmxmode=000 0 0</span><br><span class="line">tmpfs /dev/shm tmpfs rw,relatime 0 0</span><br><span class="line">/dev/sda2 / ext4 rw,relatime,barrier=1,data=ordered 0 0</span><br><span class="line">/proc/bus/usb /proc/bus/usb usbfs rw,relatime 0 0</span><br><span class="line">/dev/sda1 /boot ext4 rw,relatime,barrier=1,data=ordered 0 0</span><br><span class="line">none /proc/sys/fs/binfmt_misc binfmt_misc rw,relatime 0 0</span><br></pre></td></tr></table></figure>
<p>文件系统是需要驱动支持的，没有驱动的文件系统也无法挂载，Linux中支持的文件系统驱动在/lib/modules/$(uname -r)/kernel/fs下。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# ls /lib/modules/$(uname -r)/kernel/fs/</span><br><span class="line">autofs4  cachefiles  configfs  dlm       exportfs  ext3  fat      fuse  jbd   jffs2  mbcache.ko  nfs_common  nls       ubifs  xfs</span><br><span class="line">btrfs    cifs        cramfs    ecryptfs  ext2      ext4  fscache  gfs2  jbd2  lockd  nfs         nfsd        squashfs  udf</span><br></pre></td></tr></table></figure>
<h4 id="直接挂载镜像文件"><a href="#直接挂载镜像文件" class="headerlink" title="直接挂载镜像文件"></a>直接挂载镜像文件</h4><p>有时候需要挂载CentOS的镜像文件，在虚拟机中经常是将镜像放入虚拟机的CD/DVD虚拟光驱中，然后在Linux上对/dev/cdrom进行挂载。其实/dev/cdrom是/dev/sr0的一个软链接，/dev/sr0是Linux中的光驱，所以上面的过程相当于是将镜像文件通过虚拟软件的虚拟光驱和linux的光驱连接起来，这样只需要挂载Linux中的光驱就可以了。但是，在非虚拟环境中没有虚拟光驱，而且在Linux中的一个镜像文件难道一定要拷贝到主机上通过虚拟光驱进行连接吗？  </p>
<p>mount是一个极其强大的挂载工具，它支持挂载很多种文件类型，其中就支持挂载镜像文件，其实它连挂载目录都支持。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop CentOS-6.6-x86_64-bin-DVD2.iso /mnt</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# lsblk</span><br><span class="line">NAME     MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">loop0      7:0    0   1.2G  0 loop /mnt</span><br><span class="line">sda        8:0    0    20G  0 disk</span><br><span class="line">├─sda1   8:1    0   250M  0 part /boot</span><br><span class="line">├─sda2   8:2    0  17.8G  0 part /</span><br><span class="line">└─sda3   8:3    0     2G  0 part [SWAP]</span><br><span class="line">sr0       11:0    1  1024M  0 rom</span><br></pre></td></tr></table></figure>
<h4 id="umount"><a href="#umount" class="headerlink" title="umount"></a>umount</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount 设备名或挂载目录</span><br><span class="line">umount -lf 强制卸载</span><br></pre></td></tr></table></figure>
<p>卸载时，既可以使用设备名也可以使用挂载点卸载。有时候挂载网络系统(如NFS)时，设备名很长，这时候可以使用挂载点来卸载就方便多了。  </p>
<p>如果用户正在访问某个目录或文件，使得卸载一直显示Busy，使用fuser -v DIR可以知道谁正在访问该目录或文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# fuser -v /root</span><br><span class="line">                     USER        PID ACCESS COMMAND</span><br><span class="line">/root:               root      37453 ..c.. bash</span><br></pre></td></tr></table></figure>
<p>使用-k选项kill掉正在使用目录或文件的进程，使用-km选项kill掉文件系统上的所有进程，然后再umount。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# fuser -km /mnt/cdrom;umount /mnt/cdrom</span><br></pre></td></tr></table></figure>
<h4 id="开机自动挂载-etc-fstab"><a href="#开机自动挂载-etc-fstab" class="headerlink" title="开机自动挂载/etc/fstab"></a>开机自动挂载/etc/fstab</h4><p>通过将挂载选项写入到/etc/fstab中，系统会自动挂载该文件中的配置项。但要注意，该文件在开机的前几个过程中就被读取，所以配置错误很可能会导致开机失败。<br><img src="https://images2015.cnblogs.com/blog/733013/201706/733013-20170619153348929-1529711335.png" alt="image"><br>其中最后两列，它们分别表示备份文件系统和开机自检，一般都可以设置为0。  </p>
<p>由于能用的备份工具众多，没人会在这里设置备份，所以备份列设置为0。  </p>
<p>最后一列是开机自检设置列，开机自检调用的是fsck程序，所有有些ext类文件系统作为”/“时，可能会设置为1，但是fsck是不支持xfs文件系统的，所以对于xfs文件系统而言，该项必须设置为0。<br>其实无需考虑那么多，直接将这两列设置为0就可以了。  </p>
<h4 id="修复错误的-etc-fstab"><a href="#修复错误的-etc-fstab" class="headerlink" title="修复错误的/etc/fstab"></a>修复错误的/etc/fstab</h4><p>万一/etc/fstab配置错误，导致开机无法加载。这时提示输入root密码进入单人维护模式，只不过担任模式下根文件系统是只读的，哪怕是root也无法直接修改/etc/fstab，所以应该将”/“文件系统进行重新挂载。  </p>
<p>执行下面的命令，重挂载根分区，并给读写权限，再去修改错误的fstab文件记录，再重启。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mount -n -o remount,rw /</span><br></pre></td></tr></table></figure>
<h4 id="按需自动挂载-autofs"><a href="#按需自动挂载-autofs" class="headerlink" title="按需自动挂载(autofs)"></a>按需自动挂载(autofs)</h4><p>使用autofs实现需要挂载时就挂载，不需要挂载时5分钟后自动卸载。但是在实际环境中基本不会使用按需挂载。  </p>
<p>autofs是一个服务程序，需要让其运行在后台，可以用来挂NFS，也可挂本地的文件系统。  </p>
<p>默认不装autofs，需要自己装。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# yum install -y autofs</span><br></pre></td></tr></table></figure>
<p>autofs实现按需挂载的方式是指定监控目录，可在其配置文件/etc/auto.master中指定。  </p>
<p>/etc/auto.master里面只有两列：第一列是监控目录；第二列是记录挂载选项的文件，该文件可以随便取名。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# cat /etc/auto.master</span><br><span class="line">/share  /etc/auto.mount    # 监控/share目录，使用/etc/auto.nfs记录挂载选项</span><br></pre></td></tr></table></figure>
<p>上述监控的/share目录，其实这是监控的父目录，在此目录下的目录如/share/data目录可以作为挂载点，当访问到/share/data时就被监控到，然后会按照挂载选项将挂载设备挂载到/share/data上。  </p>
<p>上述配置中配置的挂载选项文件是/etc/auto.mount，所以建立此文件，写入挂载选项。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# cat /etc/auto.mount</span><br><span class="line">#cd              -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom</span><br><span class="line"></span><br><span class="line"># the following entries are samples to pique your imagination</span><br><span class="line">#linux          -ro,soft,intr           ftp.example.org:/pub/linux</span><br><span class="line">#boot           -fstype=ext2            :/dev/hda1</span><br><span class="line">#floppy         -fstype=auto            :/dev/fd0</span><br><span class="line">#floppy         -fstype=ext2            :/dev/fd0</span><br><span class="line">#e2floppy       -fstype=ext2            :/dev/fd0</span><br><span class="line">#jaz            -fstype=ext2            :/dev/sdc1</span><br><span class="line">#removable      -fstype=ext2            :/dev/hdd</span><br></pre></td></tr></table></figure>
<p>该文件有3列：  </p>
<p>第一列指定的是在/etc/auto.master指定的/share下的目录/share/data，它是真正的被监控路径，也是挂载点。可使用相对路径data表示/share/data。  </p>
<p>第二列是mount的选项，前面使用一个”-“表示，该列可有可无。  </p>
<p>第三列是待挂载设备，可以是NFS服务端的共享目录，也可以本地设备。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# vim /etc/auto.mount</span><br><span class="line">data   -rw,bg,soft,rsize=32768,wsize=32768     192.168.100.61:/data</span><br></pre></td></tr></table></figure>
<p>上面的配置表示当访问到/share/data时，自动使用参数(rw,bg,soft,rsize=32768,wsize=32768)挂载远端192.168.100.61的/data目录到/share/data上。  </p>
<p>剩下的步骤就是启动autofs服务。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi data]# /etc/init.d/autofs restart</span><br></pre></td></tr></table></figure>
<h3 id="swap分区"><a href="#swap分区" class="headerlink" title="swap分区"></a>swap分区</h3><p>虽说个人电脑上基本已经无需设置swap分区了，但是在服务器上还是应该准备swap分区，以做到有备无患和防止众多”玄学”问题。  </p>
<h4 id="查看swap使用情况"><a href="#查看swap使用情况" class="headerlink" title="查看swap使用情况"></a>查看swap使用情况</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# free</span><br><span class="line">            total      used      free     shared    buffers     cached</span><br><span class="line">Mem:       1906488     349376    1557112      200     16920      200200</span><br><span class="line">-/+ buffers/cache:     132256    1774232</span><br><span class="line">Swap:      2097148          0    2097148</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# free -m        # 以MB显示</span><br><span class="line">             total       used       free      shared    buffers     cached</span><br><span class="line">Mem:          1861        341       1520          0         16        195</span><br><span class="line">-/+ buffers/cache:        129       1732     # 这个是真正的可用内存空间</span><br><span class="line">Swap:         2047          0       2047     # 这个是swap空间，发现一点都没被用</span><br></pre></td></tr></table></figure>
<p>使用mount/lsblk等可以查看出哪个分区在充当swap分区。使用swapon -s也可以直接查看出。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# swapon -s</span><br><span class="line">Filename                                Type            Size    Used    Priority</span><br><span class="line">/dev/sda3                               partition       2047996 37064   -1</span><br></pre></td></tr></table></figure>
<h4 id="添加swap分区"><a href="#添加swap分区" class="headerlink" title="添加swap分区"></a>添加swap分区</h4><p>(1).可以新分一个区，在分区时指定其分区的ID号为SWAP类型。  </p>
<p>mbr和gpt格式的磁盘上这个ID可能不太一样，不过一般gpt中的格式是在mbr格式的ID后加上两位数的数值，如mbr中swap的类型ID为82，在gpt中则是8200，在mbr中linux filesystem类型的ID为83，在gpt中则为8300，在mbr中lvm的ID为8e，在gpt中为8e00。  </p>
<p>(2).格式化为swap分区：mkswap  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# mkswap /dev/sdb5</span><br><span class="line">Setting up swapspace version 1, size = 1951096 KiB</span><br><span class="line">no label, UUID=02e5af44-2a16-479d-b689-4e100af6adf5</span><br></pre></td></tr></table></figure>
<p>(3).加入swap分区空间(swapon)：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# swapon /dev/sdb5  </span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          1861        343       1517          0         16        196</span><br><span class="line">-/+ buffers/cache:        131       1730</span><br><span class="line">Swap:         3953          0       3953</span><br></pre></td></tr></table></figure>
<p>(4).取消swap分区空间(swapoff)：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# swapoff /dev/sdb5</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          1861        343       1518          0         16        196</span><br><span class="line">-/+ buffers/cache:        130       1731</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>
<p>(5).开机自动加载swap分区：<br>修改/etc/fstab，加上一行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda3    swap    swap    defaults    0    0</span><br></pre></td></tr></table></figure>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者: <a href="http://yoursite.com">John Doe</a>
            <p>原文链接: <a href="http://yoursite.com/2017/04/15/Linux分区信息与管理文件系统/">http://yoursite.com/2017/04/15/Linux分区信息与管理文件系统/</a>
            <p>发表日期: <a href="http://yoursite.com/2017/04/15/Linux分区信息与管理文件系统/">April 15th 2017, 12:00:00 am</a>
            <p>版权声明: 本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2017/04/20/ext 文件系统机制原理/" title= ext 文件系统机制原理 >
                    <div class="nextTitle">ext 文件系统机制原理</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2017/04/10/DHCP 服务/" title= DHCP服务 >
                    <div class="prevTitle">DHCP服务</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!--PC和WAP自适应版-->

    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:1020846215@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/fi3ework" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#分区"><span class="toc-number">1.</span> <span class="toc-text">分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分区方法-MBR和GPT"><span class="toc-number">1.1.</span> <span class="toc-text">分区方法(MBR和GPT)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MBR和GPT分区表信息"><span class="toc-number">1.2.</span> <span class="toc-text">MBR和GPT分区表信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加磁盘"><span class="toc-number">1.3.</span> <span class="toc-text">添加磁盘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用fdisk分区工具"><span class="toc-number">1.4.</span> <span class="toc-text">使用fdisk分区工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用gdisk分区工具"><span class="toc-number">1.5.</span> <span class="toc-text">使用gdisk分区工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用parted分区工具"><span class="toc-number">1.6.</span> <span class="toc-text">使用parted分区工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fdisk-gdisk以及parted非交互式操作分区"><span class="toc-number">1.7.</span> <span class="toc-text">fdisk/gdisk以及parted非交互式操作分区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#parted实现非交互"><span class="toc-number">1.7.1.</span> <span class="toc-text">parted实现非交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fdisk实现非交互"><span class="toc-number">1.7.2.</span> <span class="toc-text">fdisk实现非交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gdisk实现非交互"><span class="toc-number">1.7.3.</span> <span class="toc-text">gdisk实现非交互</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#格式化分区"><span class="toc-number">1.8.</span> <span class="toc-text">格式化分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mke2fs工具"><span class="toc-number">1.9.</span> <span class="toc-text">mke2fs工具</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tune2fs修改ext文件系统属性"><span class="toc-number">1.9.1.</span> <span class="toc-text">tune2fs修改ext文件系统属性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsblk"><span class="toc-number">1.10.</span> <span class="toc-text">lsblk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blkid"><span class="toc-number">1.11.</span> <span class="toc-text">blkid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parted-dev-sda-print和fdisk-l"><span class="toc-number">1.12.</span> <span class="toc-text">parted /dev/sda print和fdisk -l</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-s"><span class="toc-number">1.13.</span> <span class="toc-text">file -s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#du"><span class="toc-number">1.14.</span> <span class="toc-text">du</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#df"><span class="toc-number">1.15.</span> <span class="toc-text">df</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dumpe2fs"><span class="toc-number">1.16.</span> <span class="toc-text">dumpe2fs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#挂载和卸载文件系统"><span class="toc-number">2.</span> <span class="toc-text">挂载和卸载文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mount"><span class="toc-number">2.1.</span> <span class="toc-text">mount</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#直接挂载镜像文件"><span class="toc-number">2.2.</span> <span class="toc-text">直接挂载镜像文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#umount"><span class="toc-number">2.3.</span> <span class="toc-text">umount</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开机自动挂载-etc-fstab"><span class="toc-number">2.4.</span> <span class="toc-text">开机自动挂载/etc/fstab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修复错误的-etc-fstab"><span class="toc-number">2.5.</span> <span class="toc-text">修复错误的/etc/fstab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#按需自动挂载-autofs"><span class="toc-number">2.6.</span> <span class="toc-text">按需自动挂载(autofs)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swap分区"><span class="toc-number">3.</span> <span class="toc-text">swap分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看swap使用情况"><span class="toc-number">3.1.</span> <span class="toc-text">查看swap使用情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加swap分区"><span class="toc-number">3.2.</span> <span class="toc-text">添加swap分区</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 20
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span><a class="archive-post-title" href= "/2018/08/09/Linux 防火墙各种规则实战应用/" >[Untitled Post]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span><a class="archive-post-title" href= "/2018/08/09/Nginx 详细介绍/" >[Untitled Post]</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/15</span><a class="archive-post-title" href= "/2017/10/15/memcache  缓存原理介绍/" >memcache  缓存原理介绍</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/14</span><a class="archive-post-title" href= "/2017/09/14/keepalived 各种高可用实战演练/" >keepalived 各种高可用实战演练</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/28</span><a class="archive-post-title" href= "/2017/08/28/HAproxy 原理介绍/" >HAproxy 原理介绍</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/19</span><a class="archive-post-title" href= "/2017/08/19/lvs 详细介绍/" >lvs 详细介绍</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/11</span><a class="archive-post-title" href= "/2017/06/11/LAMP 架构的各种演示/" >LAMP 架构的各种演示</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span><a class="archive-post-title" href= "/2017/05/22/MYSQL 数据库的日志介绍/" >MYSQL 数据库的日志介绍</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/15</span><a class="archive-post-title" href= "/2017/05/15/MYSQL MariaDB 的事务和事务隔离级别/" >MYSQL MariaDB 的事务和事务隔离级别</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/08</span><a class="archive-post-title" href= "/2017/05/08/MASQL MariaDB 用户权限管理/" >MASQL MariaDB 用户权限管理</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/20</span><a class="archive-post-title" href= "/2017/04/20/ext 文件系统机制原理/" >ext 文件系统机制原理</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/15</span><a class="archive-post-title" href= "/2017/04/15/Linux分区信息与管理文件系统/" >Linux分区信息与管理文件系统</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/10</span><a class="archive-post-title" href= "/2017/04/10/DHCP 服务/" >DHCP服务</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2017/04/01/Linux系统中su 和 sudo 的用法/" >Linux系统中su 和 sudo 的用法</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span><a class="archive-post-title" href= "/2017/03/12/Linux 文件权限管理/" >Linux 文件权限管理</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/08</span><a class="archive-post-title" href= "/2017/03/08/LINUX系统中用户、组管理/" >安装管理包：LINUX系统中用户、组管理</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/15</span><a class="archive-post-title" href= "/2017/02/15/DNS 服务从基础到深入/" >DNS 服务从基础到深入</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/01</span><a class="archive-post-title" href= "/2017/02/01/rpm管理包 和 yum管理包(1)/" >安装管理包：rpm包和yum包</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2016 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/29</span><a class="archive-post-title" href= "/2016/11/29/Linux 的一些基础练习题/" >Linux 的一些基础练习题</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2018/08/09/Nginx 各种实验演示/" >[Untitled Post]</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="Linux"><span class="iconfont-archer">&#xe606;</span>Linux</span>
    
        <span class="sidebar-tag-name" data-tags="DHCP"><span class="iconfont-archer">&#xe606;</span>DHCP</span>
    
        <span class="sidebar-tag-name" data-tags="LAMP"><span class="iconfont-archer">&#xe606;</span>LAMP</span>
    
        <span class="sidebar-tag-name" data-tags="用户组"><span class="iconfont-archer">&#xe606;</span>用户组</span>
    
        <span class="sidebar-tag-name" data-tags="haproxy"><span class="iconfont-archer">&#xe606;</span>haproxy</span>
    
        <span class="sidebar-tag-name" data-tags="权限管理"><span class="iconfont-archer">&#xe606;</span>权限管理</span>
    
        <span class="sidebar-tag-name" data-tags="练习题"><span class="iconfont-archer">&#xe606;</span>练习题</span>
    
        <span class="sidebar-tag-name" data-tags="su和sudo"><span class="iconfont-archer">&#xe606;</span>su和sudo</span>
    
        <span class="sidebar-tag-name" data-tags="MYSQL"><span class="iconfont-archer">&#xe606;</span>MYSQL</span>
    
        <span class="sidebar-tag-name" data-tags="文件系统"><span class="iconfont-archer">&#xe606;</span>文件系统</span>
    
        <span class="sidebar-tag-name" data-tags="keepalied"><span class="iconfont-archer">&#xe606;</span>keepalied</span>
    
        <span class="sidebar-tag-name" data-tags="lvs"><span class="iconfont-archer">&#xe606;</span>lvs</span>
    
        <span class="sidebar-tag-name" data-tags="memcache"><span class="iconfont-archer">&#xe606;</span>memcache</span>
    
        <span class="sidebar-tag-name" data-tags="rpm"><span class="iconfont-archer">&#xe606;</span>rpm</span>
    
        <span class="sidebar-tag-name" data-tags="DNS"><span class="iconfont-archer">&#xe606;</span>DNS</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "John Doe"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


